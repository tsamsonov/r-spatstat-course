<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Глава 3 Геостатистика | Пространственная статистика и моделирование на языке R</title>
<meta name="author" content="Тимофей Самсонов">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Пространственная статистика и моделирование на языке R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Введение</a></li>
<li class="book-part">Пространственная статистика</li>
<li><a class="" href="spreg.html"><span class="header-section-number">1</span> Пространственная регрессия</a></li>
<li><a class="" href="gwr.html"><span class="header-section-number">2</span> Географически взвешенная регрессия</a></li>
<li><a class="active" href="gstat.html"><span class="header-section-number">3</span> Геостатистика</a></li>
<li><a class="" href="points.html"><span class="header-section-number">4</span> Точечные паттерны</a></li>
<li class="book-part">Пространственное моделирование</li>
<li><a class="" href="ecol.html"><span class="header-section-number">5</span> Экологические модели</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/tsamsonov/r-spatstat-course">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="gstat" class="section level1" number="3">
<h1>
<span class="header-section-number">Глава 3</span> Геостатистика<a class="anchor" aria-label="anchor" href="#gstat"><i class="fas fa-link"></i></a>
</h1>
<p><span class="math display">\[\newcommand{\Var}{\operatorname{Var}}
\newcommand{\Cov}{\operatorname{Cov}}
\newcommand{\E}{\operatorname{E}}\]</span></p>
<p><a href="https://github.com/tsamsonov/r-geo-course/blob/master/code/14-InterpolationGeostatistics.R">Программный код главы</a></p>
<div id="введение-1" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Введение<a class="anchor" aria-label="anchor" href="#%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-1"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Геостатистика</strong> — раздел математической статистики, который связан с численным описанием переменных, распределенных в географическом пространстве и, опционально, времени. Наиболее часто инструменты геостатистики используются для решения задачи интерполяции — восстановления сплошного поля распределения случайной величины по ограниченному множеству данных в точках наблюдений. Однако, геостатистика как научная дисциплина существенно шире. Ее первоочередной задачей является статистическое описание пространственных распределений.</p>
<p>В основе геостатистики лежит широко разработанный математический аппарат. Понимание основ этого аппарата является необходимым условием осмысленного примения геостатистических методов на практике. В настоящей главе мы постараемся сформировать у читателя данное понимание, и показать, как геостатистика работает на практике.</p>
<p>Мир геостатистики базируется на фундаментальных понятиях случайной величины, случайной функции и случайного процесса. Рассмотрим эти понятия.</p>
</div>
<div id="базовые-понятия-и-элементы-геостатистики" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Базовые понятия и элементы геостатистики<a class="anchor" aria-label="anchor" href="#%D0%B1%D0%B0%D0%B7%D0%BE%D0%B2%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BD%D1%8F%D1%82%D0%B8%D1%8F-%D0%B8-%D1%8D%D0%BB%D0%B5%D0%BC%D0%B5%D0%BD%D1%82%D1%8B-%D0%B3%D0%B5%D0%BE%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D0%BA%D0%B8"><i class="fas fa-link"></i></a>
</h2>
<div id="базовые-понятия" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Базовые понятия<a class="anchor" aria-label="anchor" href="#%D0%B1%D0%B0%D0%B7%D0%BE%D0%B2%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BD%D1%8F%D1%82%D0%B8%D1%8F"><i class="fas fa-link"></i></a>
</h3>
<p>Отправной точкой геостатистического анализа является конечное множество точек (локаций), в каждой из которых зафиксировано значение некоторой пространственной переменной. Пространственную и атрибутивную составляющую традиционно разделяют на две компоненты, каждая из которых может быть случайной:</p>
<ol style="list-style-type: decimal">
<li>Пространственные локации (точки)
<span class="math display">\[\{p_1, p_2, ..., p_n\}\]</span>
</li>
<li>Данные в этих локациях
<span class="math display">\[\{Z(p_1), Z(p_2), ..., Z(p_n)\}\]</span>
</li>
</ol>
<p>Данные в локациях получаются путем измерений значений пространственно распределенной переменной, или вычисления её значения на основе других данных, которые прямо или косвенно (через другие данные) базируются на прямых или дистанционных наблюдениях. Результаты измерений, как и исходные для расчетов данные, как правило, привязаны ко времени и характеризуют состояние среды на определенный момент. Если описываемое явление является динамическим (изменчивым во времени), результаты наблюдений или расчетов для двух разных моментов времени в общем случае будут различны. Эти различия невозможно <em>полностью</em> описать в аналитическом виде, поскольку природные и социально-экономические процессы формируются неопределенно большим числом факторов. Аналогично этому, невозможно и достоверно предсказать значение пространственной переменной в заданный момент времени. Чтобы работать с такими данными, используются понятия <em>случайной величины</em> и <em>случайного процесса</em>.</p>
<blockquote>
<p><strong>Случайной величиной</strong> <span class="math inline">\(Z(w)\)</span> называется функция, которая в результате случайного события <span class="math inline">\(w\)</span> принимает некоторое вещественнозначное значение.</p>
</blockquote>
<p>Например, при анализе температуры водоема в отдельно взятой точке в толще воды случайной величиной (функцией) является собственно температура, а событием — та совокупность физико-химических условий, которая сложилась в данной точке в данный момент измерений и обусловила наблюдаемое значение температуры.</p>
<p>Отметим, что <em>элемент случайности вносится именно событием</em>, которое в природе может быть сформировано сложной и трудно предсказуемой комбинацией факторов, в то время как <em>случайная величина уже связана с событием некоторой зависимостью</em>, которую можно описать с помощью аналитических или эмпирических формул.</p>
<p>Случайность можно наблюдать не только в точке, но и по пространству. Например, уровень шума, формируемый автотранспортом в открытой городской среде, меняется непрерывно, и его можно измерить в каждой точке. При этом пространственное распределение величины этого уровня будет в каждый момент времени зависеть от случайного события — размещения автомобилей и уровня шума, производимого каждым из них. Городская среда оказывается полностью заполнена шумовым эфиром, густота которого неодинакова в пространстве и времени. Перемещаясь из точки в точку или ожидая последующего момента времени, находясь в одной точке, мы будем наблюдать разный уровень шума. Состояние этого шумового эфира как единого целого является <em>случайным процессом</em>.</p>
<p>Введем общее понятие случайного процесса:</p>
<blockquote>
<p><strong>Случайный процесс</strong> это семейство случайных величин, индексированных некоторым параметром <span class="math inline">\(t\)</span></p>
</blockquote>
<p>Наиболее часто анализируются одномерные случайные процессы, в которых <span class="math inline">\(t\)</span> — это время. Классическим примером такого процесса является количество покупателей, находящихся в магазине.</p>
<p>Пространственная статистика изучает случайные процессы, в которых <span class="math inline">\(t\)</span> — это координата точки (обычно на плоскости). Такие процессы характеризуются следующими особенностями:</p>
<ul>
<li><p>в каждой точке <span class="math inline">\(p_i\)</span> существует некоторая <em>случайная величина</em> <span class="math inline">\(Z(p_i)\)</span> — <strong>сечение случайного процесса</strong></p></li>
<li><p>при изменении точки <span class="math inline">\(p_i\)</span> наблюдаемое значение случайного процесса меняется случайным образом, поскольку определяется оно не только местоположением, но и заранее неизвестным случайным событием.</p></li>
</ul>
<p>Для описания случайных процессов в пространстве необходимо сформировать базовую математическую модель, а также определить ее свойства.</p>
</div>
<div id="случайный-процесс-в-пространстве-и-его-моменты" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Случайный процесс в пространстве и его моменты<a class="anchor" aria-label="anchor" href="#%D1%81%D0%BB%D1%83%D1%87%D0%B0%D0%B9%D0%BD%D1%8B%D0%B9-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81-%D0%B2-%D0%BF%D1%80%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D1%81%D1%82%D0%B2%D0%B5-%D0%B8-%D0%B5%D0%B3%D0%BE-%D0%BC%D0%BE%D0%BC%D0%B5%D0%BD%D1%82%D1%8B"><i class="fas fa-link"></i></a>
</h3>
<p>Пусть <span class="math inline">\(p \in \mathbb{R}^k\)</span> — точка в <span class="math inline">\(k\)</span>-мерном Евклидовом пространстве и <span class="math inline">\(Z(p)\)</span> — <strong>случайная величина</strong> в точке <span class="math inline">\(p\)</span>. Тогда если <span class="math inline">\(p\)</span> меняется в пределах области <span class="math inline">\(D \subset \mathbb{R}^k\)</span> (эта область именуется <em>индексным множеством</em>), то формируется <strong>случайный процесс</strong>:</p>
<p><span class="math display">\[\{Z(p) | p \in D\}\]</span>
Вертикальная черта в соответствии с принятой в теории вероятности нотацией означает <em>условие</em>. То есть, переменная <span class="math inline">\(p\)</span> ограничена областью <span class="math inline">\(D\)</span>.</p>
<p>Результат наблюдения случайного процесса в точках области <span class="math inline">\(D\)</span> является <strong>реализацией</strong> случайного процесса:</p>
<p><span class="math display">\[\{z(p) | p \in D\}\]</span></p>
<blockquote>
<p>В общем случае <span class="math inline">\(D\)</span> и <span class="math inline">\(Z\)</span> случайны и независимы</p>
</blockquote>
<p>Случайный процесс, как и случайную величину, можно описать с помощью статистических моментов, таких как математическое ожидание и дисперсия.</p>
<p><strong>Математическое ожидание</strong> есть наиболее вероятная реализация случайного процесса:</p>
<p><span class="math display">\[\E[Z(p)]=m(p)\]</span></p>
<p>Поясним суть математического ожидания СП на следующем примере:</p>
<ul>
<li>Пусть дан географический регион, в пределах которого рассматривается поле температуры и его временная изменчивость.</li>
<li>В каждый момент времени мы имеем непрерывное поле температуры — реализацию случайного процесса.</li>
<li>Если рассмотреть поведение это поля во временном разрезе (по аналогии с колебаниями волн в пространстве), то получим некое “среднее” поле — математическое ожидаение случайного процесса.</li>
</ul>
<p>Если в приведенном примере температура наблюдается посредством сети метеостанций, то в каждый момент времени реализацию СП можно приблизительно восстановить путем выполнения интерполяции по их данным. Осреднив же данные по времени, и снова проинтерполировав их, получим <em>выборочную среднюю</em> поверхность — оценку мат. ожидания СП.</p>
<p><strong>Дисперсия</strong> есть мера разброса реализаций случайного процесса относительно его математического ожидания:</p>
<p><span class="math display">\[\Var[Z(p)]= \E[Z^2(p)]-m^2(p)\]</span>
Аналогично математическому ожиданию, дисперсия двумерного СП представляет собой <em>поле распределения</em>. Величина этого поля каждой точке равна дисперсии сечения СП в этой точке, то есть дисперсии случайной величины. Так же как и в традиционной статистике, вместо дисперсии в расчетах часто используют среднеквадратическое отклонение, поскольку оно выражено в тех же единицах, что и сама случайная величина:</p>
<p><span class="math display">\[\sigma(p)= \sqrt{\Var[Z(p)]}\]</span></p>
<p>В случае поля температуры можно представить себе объем, ограниченный двумя поверхностями <span class="math inline">\(m(p) + \sigma(p)\)</span> и <span class="math inline">\(m(p) - \sigma(p)\)</span>. Расстояние между этими поверхностями в каждой точке <span class="math inline">\(p\)</span> представляет собой среднеквадратическое отклонение случайного процесса.</p>
<p><strong>Ковариация</strong> — это мера линейной зависимости сечений случайного процесса в двух точках <span class="math inline">\(p_1\)</span> и <span class="math inline">\(p_2\)</span>:</p>
<p><span class="math display">\[\Cov(p_1,p_2) = \Cov[Z(p_1), Z(p_2)] = \E[Z(p_1)Z(p_2)]-m(p_1)m(p_2)\]</span></p>
<blockquote>
<p>Для вычисления ковариации необходимость знать математическое ожидание СП. Это условие выполняется далеко не всегда, что связано с тем что как правило приходится иметь дело только с одной его реализацией.</p>
</blockquote>
<p>Следует обратить внимание на то, что <em>моменты пространственных случайных процессов являются функциями, а не константами</em>, в отличие от моментов случайных величин.</p>
<p>Давать оценку пространственной структуре явления на основе вычисленных моментов с.п. можно при условии, что он удовлетворяет свойствам <strong>стационарности</strong> и <strong>эргодичности.</strong></p>
</div>
</div>
<div id="стационарность-и-эргодичность" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Стационарность и эргодичность<a class="anchor" aria-label="anchor" href="#%D1%81%D1%82%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%B8-%D1%8D%D1%80%D0%B3%D0%BE%D0%B4%D0%B8%D1%87%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><i class="fas fa-link"></i></a>
</h2>
<div id="стационарность" class="section level3" number="3.3.1">
<h3>
<span class="header-section-number">3.3.1</span> Стационарность<a class="anchor" aria-label="anchor" href="#%D1%81%D1%82%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Стационарность</strong> <em>в строгом смысле</em> означает что функция распределения множества случайных величин для любой комбинации точек <span class="math inline">\({x_1, x_2,...,x_k}\)</span> и любого <span class="math inline">\(k &lt; \infty\)</span> остается неизменной при смещении этой комбинации на произвольный вектор <span class="math inline">\(h\)</span>:</p>
<p><span class="math display">\[P\{Z(x_1)&lt;z_1,...,Z(x_k)&lt;z_k\} = P\{Z(x_1 + h)&lt;z_1,...,Z(x_k + h)&lt;z_k\}\]</span></p>
<ul>
<li><p>Стационарность по другому называют <strong>однородностью в пространстве</strong>, подразумевая что явление ведет себя одинаковым образом в любой точке пространства, как бы повторяет само себя.</p></li>
<li><p>Если СФ стационарна, все ее моменты будут инвариантны относительно сдвигов (то есть будут постоянны), а это означает что для их оценки можно использовать ограниченную в пространстве область.</p></li>
</ul>
<p>В реальности подобного рода «идеальное» поведение встречается крайне редко, поэтому используют более слабое предположение о стационарности второго порядка.</p>
<p>Случайная функция имеет имеет <strong>стационарность второго порядка</strong>, если для любых точек <span class="math inline">\(x\)</span> и <span class="math inline">\(x+h\)</span> в <span class="math inline">\(R^k\)</span></p>
<p><span class="math display">\[\begin{cases}
  \E[Z(x)] = m \\
  \E[(Z(x)-m)(Z(x+h)-m)] = \Cov(h)
\end{cases}\]</span></p>
<p>Данные условия означают, что математическое ожидание СФ постоянно, а ковариация зависит только от вектора <span class="math inline">\(h\)</span> между точками и не зависит от их абсолютного положения.</p>
<p>Если ковариация также не зависит от направления, а только от расстояния между точками, то <span class="math inline">\(h\)</span> вырождается в скаляр, а такая случайная функция является <em>изотропной стационарной</em>.</p>
</div>
<div id="эргодичность" class="section level3" number="3.3.2">
<h3>
<span class="header-section-number">3.3.2</span> Эргодичность<a class="anchor" aria-label="anchor" href="#%D1%8D%D1%80%D0%B3%D0%BE%D0%B4%D0%B8%D1%87%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><i class="fas fa-link"></i></a>
</h3>
<p>Стационарная случайная функция <span class="math inline">\(Z(x,w)\)</span> называется <strong>эргодической</strong>, если ее среднее по области <span class="math inline">\(V \subset R^k\)</span> сходится к математическому ожиданию <span class="math inline">\(m(w)\)</span> при стремлении <span class="math inline">\(V\)</span> к бесконечности:</p>
<p><span class="math display">\[\lim_{V \rightarrow \infty} \frac{1}{|V|}\int_{V} Z(x,w)dx = m(w),\]</span>
где <span class="math inline">\(|V|\)</span> обозначает <em>меру</em> области <span class="math inline">\(V\)</span> (площадь, объем). Предполагается что сама область <span class="math inline">\(V\)</span> растет во всех направлениях, и предел ее роста не зависит от ее формы.</p>
<blockquote>
<p>Следствием эргодичности является то, что среднее по всем возможным реализациям равно среднему отдельной безграничной в пространстве реализации.</p>
</blockquote>
<p>Смысл эргодичности можно пояснить на следующем примере. Пусть дан кувшин с песком, в котором необходимо определить долю объема, занятую содержимым. Проведем следующий эксперимент:</p>
<ul>
<li>Зафиксируем некоторую точку <span class="math inline">\(x\)</span> в системе отсчета, привязанной к кувшину, и будем его встряхивать бесконечное число раз, каждый раз фиксируя, оказалась ли точка <span class="math inline">\(x\)</span> внутри песчинки (записываем 1) или же попала в свободное между ними пространство (записываем 0)</li>
<li>Из серии подобных экспериментов мы сможем оценить среднее значение индикаторной функции <span class="math inline">\(I(x,w)\)</span>, которое равно вероятности попадания зерна в точку <span class="math inline">\(x\)</span>, и которое не зависит от <span class="math inline">\(x\)</span>.</li>
<li>Эта вероятность и будет равна доли объема кувшина, занятой песком.</li>
</ul>
<p>Аналогичный результат можно получить, если теперь зафиксировать кувшин, а точку <span class="math inline">\(x\)</span> выбирать каждый раз случайным образом. Однако в первом случае берется среднее по реализациям, а во втором среднее по пространству.</p>
</div>
</div>
<div id="геостатистическое-оценивание" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Геостатистическое оценивание<a class="anchor" aria-label="anchor" href="#%D0%B3%D0%B5%D0%BE%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5-%D0%BE%D1%86%D0%B5%D0%BD%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"><i class="fas fa-link"></i></a>
</h2>
<div id="простой-кригинг" class="section level3" number="3.4.1">
<h3>
<span class="header-section-number">3.4.1</span> Простой кригинг<a class="anchor" aria-label="anchor" href="#%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3"><i class="fas fa-link"></i></a>
</h3>
<p>Для оценки в точке <span class="math inline">\(Z_0 = Z(p_0)\)</span> по <span class="math inline">\(N\)</span> измерениям <span class="math inline">\(Z_1, ..., Z_N\)</span> ищутся коэффициенты <span class="math inline">\(\lambda\)</span> следующего выражения:</p>
<p><span class="math display">\[Z^* = \sum_{i} \lambda_i Z_i + \lambda_0,\]</span>
где константа <span class="math inline">\(\lambda_0 = \lambda(p_0)\)</span> и веса <span class="math inline">\(\lambda_i\)</span> подобираются в точке <span class="math inline">\(p_0\)</span> таким образом, что минимизируется среднеквадратическая ошибка:</p>
<p><span class="math display">\[\E[Z^* - Z_0]^2,\]</span>
то есть, математическое ожидание квадрата отклонения оценки от теоретического значения.</p>
<blockquote>
<p>Согласно традиции, принятой в литературе по геостатистике, оценка в точке <span class="math inline">\(p_0\)</span> обозначается звездочкой (<span class="math inline">\(Z^*\)</span>), а истинное (неизвестное) значение нулевым индексом (<span class="math inline">\(Z_0\)</span>).</p>
</blockquote>
<blockquote>
<p>В целях уменьшения количества скобок мы используем нотацию <span class="math inline">\(\operatorname{E}[Z^* - Z_0]^2 = \operatorname{E}\big[(Z^* - Z_0)^2\big]\)</span></p>
</blockquote>
<p>Теоретическое значение <span class="math inline">\(Z_0\)</span>, входящее в формулу ошибки, не известно. Однако, как будет показано далее, его знание и не требуется, поскольку <em>ищется не сам квадрат отклонения, а его математическое ожидание</em>.</p>
<p>Используя соотношение <span class="math inline">\(\Var[X] = \E[X^2] - (\E[X])^2\)</span>, выразим среднюю квадратическую ошибку как:</p>
<p><span class="math display">\[\E[Z^* - Z_0]^2 = \Var[Z^* - Z_0] + \big(\E[Z^* - Z_0]\big)^2\]</span></p>
<p>Поскольку дисперсия нечувствительна к сдвигам, изменение константы <span class="math inline">\(\lambda_0\)</span> влияет только на компоненту <span class="math inline">\(\E[Z^* - Z_0]\)</span>. Приравняем ее нулю:</p>
<p><span class="math display">\[\E[Z^* - Z_0] = \E\Big[\sum_{i} \lambda_i Z_i + \lambda_0 - Z_0\Big] = 0\]</span></p>
<p>Используя свойства математического ожидания, выразим из этого выражения <span class="math inline">\(\lambda_0\)</span>:</p>
<p><span class="math display">\[\lambda_0 = - \E\Big[\sum_{i} \lambda_i Z_i - Z_0\Big] = \E[Z_0] - \sum_{i} \lambda_i \E[Z_i] = m_0 - \sum_i \lambda_i m_i,\]</span></p>
<p>где <span class="math inline">\(m_i\)</span> — теоретически известные значения мат. ожидания случайной функции в точках исходных данных <span class="math inline">\(p_i\)</span>, <span class="math inline">\(m_0\)</span> — теоретически известное мат. ожидание случайной функции в оцениваемой точке <span class="math inline">\(p_0\)</span>.</p>
<p>Имея:</p>
<p><span class="math display">\[Z^* = \sum_{i} \lambda_i Z_i + \lambda_0,\\
\lambda_0 = m_0 - \sum_i \lambda_i m_i,\]</span></p>
<p>Получаем:</p>
<p><span class="math display">\[Z^* = \sum_{i} \lambda_i Z_i + m_0 - \sum_i \lambda_i m_i = m_0 + \sum_{i} \lambda_i (Z_i - m_i)\]</span>
Поскольку математические ожидания <span class="math inline">\(m_0\)</span> и <span class="math inline">\(m_i\)</span> предполагаются известными, величину <span class="math inline">\(Z(p)\)</span> можно заменить величиной <span class="math inline">\(Y(p) = Z(p) - m(p)\)</span> в обеих частях уравнения (это эквивалентно вычитанию известного тренда из исходных измерений):</p>
<p><span class="math display">\[
Z^* = m_0 + \sum_{i} \lambda_i (Z_i - m_i),\\
\underbrace{Z^* - m_0}_{Y^*} = \sum_{i} \lambda_i \underbrace{(Z_i - m_i)}_{Y_i},\\
Y^* =  \sum_{i} \lambda_i Y_i.
\]</span>
Это означает, что оценку <span class="math inline">\(Z^*\)</span> можно заменить оценкой <span class="math inline">\(Y^*\)</span> и прибавлением к ней среднего значения <span class="math inline">\(m_0\)</span>:</p>
<p><span class="math display">\[Z^* = m_0 + \sum_{i} \lambda_i Y_i,\]</span></p>
<p>Обратим внимание на то, что <span class="math inline">\(\E[Y^* - Y_0] = \underbrace{\E[Y^*]}_0 - \underbrace{\E[Y_0]}_0 = 0\)</span> по определению <span class="math inline">\(Y(p)\)</span>. В этом случае также <span class="math inline">\(\lambda_0 = \underbrace{\E[Y_0]}_0 - \sum_{i} \lambda_i \underbrace{\E[Y_i]}_0 = 0\)</span> .</p>
<p>Чтобы не загромождать дальнейшее изложение формулами, примем, что <span class="math inline">\(Z^* := Y^*\)</span>, предполагая, что исходная величина уже центрирована относительно мат. ожидания, и к результату вычислений его надо прибавить.</p>
<p>Поскольку <span class="math inline">\(\E[Z^* - Z_0] = 0\)</span>, среднеквадратическую ошибка будет равна дисперсии:</p>
<p><span class="math display">\[\E[Z^* - Z_0]^2 = \Var[Z^* - Z_0]\]</span>
Выразим дисперсию разностей в терминах статистических моментов исходной функции. Для этого воспользуемся следующими свойствами дисперсии и ковариации:</p>
<ul>
<li>
<span class="math inline">\(\Var[X + Y] = \Var[X] + \Var[Y] + 2\Cov[X, Y]\)</span>;</li>
<li>
<span class="math inline">\(\Var[-X] = \Var[X]\)</span>;</li>
<li>
<span class="math inline">\(\Cov[X, -Y] = -\Cov[X, Y]\)</span>.</li>
</ul>
<p>Используя эти свойства, получаем:</p>
<p><span class="math display">\[\E[Z^* - Z_0]^2 = \Var[Z^* - Z_0] = \Var[Z^*] + \Var[Z_0] - 2\Cov[Z^*, Z_0].\]</span></p>
<p>Чтобы минимизировать данное выражение, необходимо раскрыть содержание трёх его компонент. Для этого нам понадобится следующая теорема, позволяющая выразить ковариацию двух линейных комбинаций случайных величин через ковариацию самих исходных случайных величин:</p>

<div class="theorem">
<p><span id="thm:unnamed-chunk-1" class="theorem"><strong>Теорема 3.1  </strong></span>Пусть <span class="math inline">\(X_1,\ldots, X_n\)</span> случайные величины, а <span class="math inline">\(Y_1 = \sum\limits_{i=1}^n a_i X_i,\; Y_2 = \sum\limits_{j=1}^m b_j X_j\)</span> — их две произвольные линейные комбинации. Тогда:</p>
<span class="math display">\[\Cov[Y_1,Y_2] = \sum\limits_{i=1}^n\sum\limits_{j=1}^m a_i b_j \Cov[X_i,X_j].\]</span>
</div>
<p>Используя результат этой теоремы, а также тот факт, что <span class="math inline">\(\Var[X] = \Cov[X, X]\)</span>, распишем каждую компоненту вышеприведенного выражения:</p>
<ul>
<li><p><span class="math inline">\(\Var[Z^*] = \Cov[Z^*, Z^*] = \Cov\Big[\sum_{i} \lambda_i Z_i, \sum_{j} \lambda_j Z_j\Big] =\\\sum_{i}\sum_{j} \lambda_i \lambda_j \Cov[Z_i, Z_j] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij},\)</span></p></li>
<li><p><span class="math inline">\(\Var[Z_0] = \Cov[Z_0, Z_0] = \sigma_{00},\)</span></p></li>
<li><p><span class="math inline">\(\Cov[Z^*, Z_0] = \Cov\Big[\sum_{i} \lambda_i Z_i, Z_0\Big] = \sum_{i} \lambda_i \Cov[Z_i, Z_0] = \sum_{i} \lambda_i \sigma_{i0},\)</span></p></li>
</ul>
<p>где <span class="math inline">\(\sigma_{ij}\)</span> — ковариация случайных величин в точках <span class="math inline">\(p_i\)</span> и <span class="math inline">\(p_j\)</span>, <span class="math inline">\(\sigma_{i0}\)</span> — ковариация случайных величин в точках <span class="math inline">\(p_i\)</span> и оцениваемой точке <span class="math inline">\(p_0\)</span>, <span class="math inline">\(\sigma_{00}\)</span> — дисперсия в точке <span class="math inline">\(p_0\)</span>.</p>
<p>Используя полученные соотношения, выражение для ошибки</p>
<p><span class="math display">\[\E[Z^* - Z_0]^2 = \Var[Z^*] + \Var[Z_0] - 2\Cov[Z^*, Z_0]\]</span></p>
<p>можно представить следующим образом:</p>
<p><span class="math display">\[\E[Z^* - Z_0]^2 = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}\]</span></p>
<p>Для нахождения минимума этой квадратичной функции необходимо приравнять нулю ее производные по основной переменной <span class="math inline">\(\lambda\)</span>. Выберем в качестве «жертвы» коэффициенты с индексом <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[\frac{\partial}{\partial \lambda_i} \E[Z^* - Z_0]^2 = 2 \sum_{j} \lambda_j \sigma_{ij} - 2 \sigma_{i0} = 0\]</span></p>
<p>Таким образом, система уравнений <strong>простого кригинга</strong> для точки <span class="math inline">\(Z_0\)</span> имеет вид:</p>
<p><span class="math display">\[\color{red}{\boxed{\color{blue}{\sum_{j} \lambda_j \sigma_{ij} = \sigma_{i0}\color{gray}{,~i = 1,...,N}}}}\]</span></p>
<p>Полученные <strong>уравнения простого кригинга носят чисто теоретический характер</strong>, поскольку предполагают знание ковариационной матрицы <span class="math inline">\(\Sigma = \{\sigma_{ij}\}\)</span> случайного процесса. Тем не менее, на их основе удобно выводить уравнения обычного (ординарного) кригинга, в котором подобное знание уже не требуется.</p>
</div>
<div id="дисперсия-простого-кригинга" class="section level3" number="3.4.2">
<h3>
<span class="header-section-number">3.4.2</span> Дисперсия простого кригинга<a class="anchor" aria-label="anchor" href="#%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B3%D0%BE-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3%D0%B0"><i class="fas fa-link"></i></a>
</h3>
<p>Существует возможность оценить в каждой точке не только величину показателя, но также дисперсию оценки (в случае постоянного мат. ожидания — среднеквадратическую ошибку).</p>
<p>Для этого необходимо коэффициенты <span class="math inline">\(\lambda_i\)</span>, полученные из системы уравнения простого кригинга</p>
<p><span class="math display">\[\sum_{j} \lambda_j \sigma_{ij} = \sigma_{i0}\]</span></p>
<p>подставить в выражение среднеквадратической ошибки</p>
<p><span class="math display">\[\Var[Z^* - Z_0] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}\]</span></p>
<p>Умножим обе части каждого уравнения простого кригинга на <span class="math inline">\(\lambda_i\)</span> и просуммируем все уравнения по <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[\sum_{j} \lambda_j \sigma_{ij} = \sigma_{i0}~\Bigg|\times \lambda_i\\
\color{red}{\sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij}} = \color{blue}{\sum_{i}\lambda_i\sigma_{i0}}\]</span></p>
<p>Заметим, что левая часть уравнения присутствует в выражении среднеквадратической ошибки:</p>
<p><span class="math display">\[\Var[Z^* - Z_0] = \color{red}{\sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij}} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}\]</span></p>
<p>Выполним соответствующую замену <span class="math inline">\(\sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij}\)</span> на <span class="math inline">\(\sum_{i}\lambda_i\sigma_{i0}\)</span>:</p>
<p><span class="math display">\[\Var[Z^* - Z_0] = \color{blue}{\sum_{i}\lambda_i\sigma_{i0}} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}\]</span></p>
<p>Отсюда получаем выражение для дисперсии (ошибки) простого кригинга:</p>
<p><span class="math display">\[\color{red}{\boxed{\color{blue}{\sigma_{SK} = \Var[Z^* - Z_0] = \sigma_{00} - \sum_{i}\lambda_i\sigma_{i0}}}}\]</span></p>
</div>
<div id="стационарность-приращений" class="section level3" number="3.4.3">
<h3>
<span class="header-section-number">3.4.3</span> Стационарность приращений<a class="anchor" aria-label="anchor" href="#%D1%81%D1%82%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%BF%D1%80%D0%B8%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D0%B9"><i class="fas fa-link"></i></a>
</h3>
<p>Стационарность второго порядка требует знания математического ожидания для вычисления ковариации.</p>
<p>В ряде случаев оценить математическое ожидание оказывается невозможно (оно может не существовать) или же оно действительно оказывается непостоянным.</p>
<p>Тогда пользуются еще более мягкой формой стационарности <strong>стационарностью приращений</strong>, при которой стационарной предполагается не сама с.ф. <span class="math inline">\(Z(x)\)</span>, а производная от нее функция:</p>
<p><span class="math display">\[Y_h(x) = Z(x+h)-Z(x)\]</span></p>
<p>Функция <span class="math inline">\(Z(x)\)</span>, обладающая таким свойством, называется подчиняющейся <em>внутренней гипотезе</em>.</p>
<p>У функции <span class="math inline">\(Y_h(x) = Z(x+h)-Z(x)\)</span> должны существовать математическое ожидание и дисперсия <strong>приращений</strong>:</p>
<p><span class="math display">\[\begin{cases}
\E[Z(x+h)-Z(x)] = \langle a,h \rangle \\
\Var[Z(x+h)-Z(x)] = 2\gamma(h)
\end{cases}\]</span></p>
<ul>
<li><p><span class="math inline">\(\langle a,h \rangle\)</span> обозначает линейный тренд <span class="math inline">\(a\)</span> при заданном векторе <span class="math inline">\(h\)</span> (<em>математическое ожидание разности значений</em>), который варажется через скалярное произведение: <span class="math inline">\(\langle a,h \rangle = \sum_i a_i h_i\)</span></p></li>
<li><p><span class="math inline">\(\gamma(h)\)</span> — дисперсия приращений, называемая <em>вариограммой</em></p></li>
</ul>
<p>Если процесс подчиняется гипотезе стационарности второго рода <span class="math inline">\(\E[Z(x)] = m\)</span>, то <span class="math inline">\(\E[Z(x+h)-Z(x)] = \E[Y_h(x)] = 0\)</span> и вариограмму можно выразить следующим образом:</p>
<p><span class="math display">\[2\gamma(h) = \Var[Z(x+h)-Z(x)] = \Var[Y_h(x)] \\=\E\big[Y_h(x)\big]^2 - \Big(\E\big[Y_h(x)\big]\Big)^2 \\=\E\big[Y_h(x)\big]^2 = \E\big[Z(x+h)-Z(x)\big]^2\]</span></p>
<p>Таким образом, наиболее распространенная в геостатистике гипотеза подчиняется следующим условиям:</p>
<p><span class="math display">\[\begin{cases}
\E\big[Z(x)\big] = m\\
\E\big[Z(x+h)-Z(x)\big] = 0 \\
\E\big[Z(x+h)-Z(x)\big]^2 = 2\gamma(h)
\end{cases}\]</span></p>
<ul>
<li><p>Эти условия позволяют избавиться от необходимости знания среднего значения и дисперсии случайной функции и использовать для вычислений вариограмму.</p></li>
<li><p>Чтобы модифицировать соответствующим образом уравнения простого кригинга, необходимо знать связь между ковариацией и вариограммой.</p></li>
</ul>
</div>
<div id="переход-от-ковариации-к-вариограмме" class="section level3" number="3.4.4">
<h3>
<span class="header-section-number">3.4.4</span> Переход от ковариации к вариограмме<a class="anchor" aria-label="anchor" href="#%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4-%D0%BE%D1%82-%D0%BA%D0%BE%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D1%86%D0%B8%D0%B8-%D0%BA-%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B5"><i class="fas fa-link"></i></a>
</h3>
<div id="предварительные-условия" class="section level4" number="3.4.4.1">
<h4>
<span class="header-section-number">3.4.4.1</span> Предварительные условия<a class="anchor" aria-label="anchor" href="#%D0%BF%D1%80%D0%B5%D0%B4%D0%B2%D0%B0%D1%80%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D1%83%D1%81%D0%BB%D0%BE%D0%B2%D0%B8%D1%8F"><i class="fas fa-link"></i></a>
</h4>
<p>Для того чтобы функция могла считаться ковариацией, необходимо, чтобы дисперсия, вычисленная на ее основе, была положительной:</p>
<p><span class="math display">\[\Var \Bigg[\sum_{i=1}^N \lambda_i Z(x_i)\Bigg] = \Cov\Bigg[\sum_{i=1}^N \lambda_i Z(x_i), \sum_{j=1}^N \lambda_j Z(x_j)\Bigg] = \\=\sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j \Cov\big[Z(x_i), Z(x_j)\big] \\= \sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j C(x_j - x_i)\]</span></p>
<blockquote>
<p>Функция <span class="math inline">\(C(h)\)</span>, для которой при любых значениях <span class="math inline">\(N\)</span>, <span class="math inline">\(x_i\)</span> и <span class="math inline">\(\lambda_i\)</span> выражение <span class="math inline">\(\sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j C(x_j - x_i)\)</span> принимает неотрицательные значения, называется <strong>положительно определенной</strong>.</p>
</blockquote>
<p>Если функция отвечает внутренней гипотезе, нет гарантий, что ее ковариация существует и ограничена. В этом случае можно оценить дисперсию суммы случайных функций через дисперсию приращений, наложив дополнительное условие <span class="math inline">\(\sum_{i=1}^N \lambda_i = 0\)</span>. Учитывая что <span class="math inline">\(\sum_{i=1}^N \lambda_i Z(x_0) = Z(x_0) \sum_{i=1}^N \lambda_i = 0\)</span>, имеем:</p>
<p><span class="math display">\[\sum_{i=1}^N \lambda_i Z(x_i) = \sum_{i=1}^N \lambda_i Z(x_i) - \sum_{i=1}^N \lambda_i Z(x_0) = \sum_{i=1}^N \lambda_i \big[Z(x_i) - Z(x_0)\big]\]</span></p>
<blockquote>
<p>Линейные комбинации, отвечающие условию <span class="math inline">\(\sum_{i=1}^N \lambda_i = 0\)</span>, называются <strong>допустимыми линейными комбинациями</strong>.</p>
</blockquote>
</div>
<div id="вывод-выражения-для-ковариации-через-вариограмму" class="section level4" number="3.4.4.2">
<h4>
<span class="header-section-number">3.4.4.2</span> Вывод выражения для ковариации через вариограмму<a class="anchor" aria-label="anchor" href="#%D0%B2%D1%8B%D0%B2%D0%BE%D0%B4-%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B4%D0%BB%D1%8F-%D0%BA%D0%BE%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D1%86%D0%B8%D0%B8-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D1%83"><i class="fas fa-link"></i></a>
</h4>
<p>Рассмотрим ковариацию двух линейных комбинаций с.ф.:</p>
<p><span class="math display">\[\Cov \Bigg[\sum_{i=1}^N \lambda_i Z(x_i), \sum_{j=1}^M \mu_j Z(x_j) \Bigg] = \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j C(x_j - x_i)\]</span></p>
<p>Используя правило <span class="math inline">\(\Cov[X + \alpha, Y + \beta] = \Cov[X, Y]\)</span>, введем условное начало координат:</p>
<p><span class="math display">\[\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j C(x_j - x_i) =\\
=\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \Cov \big[Z(x_i) - Z(x_0), Z(x_j) - Z(x_0)\big]\]</span></p>
<p>Распишем ковариацию через математические ожидания, учитывая, что, согласно гипотезе, <span class="math inline">\(\E\big[Z(x+h)-Z(x)\big] = 0\)</span>:</p>
<p><span class="math display">\[\Cov \big[Z(x_i) - Z(x_0), Z(x_j) - Z(x_0)\big] =\\
= \E\big[Z_i - Z_0\big]\big[Z_j - Z_0\big] - \E\big[Z_i - Z_0\big] E\big[Z_j - Z_0\big] = \\
= \E\big[Z_i - Z_0\big]\big[Z_j - Z_0\big]\]</span></p>
<p>Обратим внимание, что произведение приращений можно выразить через квадраты приращений:</p>
<p><span class="math display">\[\color{blue}{(Z_j - Z_i)^2} = \big[(Z_j - Z_0) - (Z_i - Z_0)\big]^2 = \\ = \color{blue}{(Z_i - Z_0)^2} - 2\color{red}{(Z_i - Z_0)(Z_j - Z_0)} + \color{blue}{(Z_j - Z_0)^2}\]</span></p>
<p>Имеем:</p>
<p><span class="math display">\[ (Z_i - Z_0)(Z_j - Z_0) = \frac{1}{2} \Big[(Z_i - Z_0)^2 + (Z_j - Z_0)^2 - (Z_j - Z_i)^2\Big]\]</span>
Учитывая, что <span class="math inline">\(\E\big[Z(x+h)-Z(x)\big]^2 = 2\gamma(h)\)</span>, подставим это выражение в формулу вычисления ковариации:</p>
<p><span class="math display">\[\Cov \big[Z(x_i) - Z(x_0), Z(x_j) - Z(x_0)\big] = \E\big[Z_i - Z_0\big]\big[Z_j - Z_0\big] = \\
= \frac{1}{2} \E \Big[(Z_i - Z_0)^2 + (Z_j - Z_0)^2 - (Z_j - Z_i)^2\Big] = \\
= \gamma(x_i - x_0) + \gamma(x_j - x_0) - \gamma(x_j - x_i)\]</span></p>
<p>Подставим полученное выражение в двойную сумму:</p>
<p><span class="math display">\[\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \Cov \big[Z(x_i) - Z(x_0), Z(x_j) - Z(x_0)\big] = \\ 
= \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \big[\gamma(x_i - x_0) + \gamma(x_j - x_0) - \gamma(x_j - x_i)\big] = \\
= \underbrace{\color{red}{\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_i - x_0)}}_0 + \underbrace{\color{blue}{\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_j - x_0)}}_0 - \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_j - x_i) = \\
= - \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_j - x_i),\]</span></p>
<p>Компоненты суммы, содержащие <span class="math inline">\(x_0\)</span>, будут равны нулю, поскольку они содержат коэффициенты с индексами, не участвующими в вычислении <span class="math inline">\(\gamma\)</span> — суммирование по этим индексам можно вынести наружу:</p>
<ul>
<li><span class="math inline">\(\color{red}{\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_i - x_0)} = \underbrace{\sum_{j=1}^M \mu_j}_0 \sum_{i=1}^N \lambda_i \gamma(x_i - x_0) = 0;\)</span></li>
<li><span class="math inline">\(\color{blue}{\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_j - x_0)} = \underbrace{\sum_{i=1}^N \lambda_i}_0 \sum_{j=1}^M \mu_i \gamma(x_j - x_0) = 0,\)</span></li>
</ul>
<p>где соотношения <span class="math inline">\(\sum_{i=1}^N \lambda_i = 0\)</span> и <span class="math inline">\(\sum_{j=1}^M \mu_j = 0\)</span> соблюдаются в силу того, что мы работаем с <em>допустимыми линейными комбинациями</em>.</p>
<p>Согласно полученным выкладкам у нас появляется возможность сравнить выражение для ковариации двух линейных комбинаций случайных величин для стационарного случая и внутренней гипотезы:</p>
<p><span class="math display">\[\Cov \Bigg[\sum_{i=1}^N \lambda_i Z(x_i), \sum_{j=1}^M \mu_j Z(x_j) \Bigg] = \underbrace{\sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \sigma(x_j - x_i)}_{\texttt{стационарный случай}} = \underbrace{- \sum_{i=1}^N \sum_{j=1}^M \lambda_i \mu_j \gamma(x_j - x_i)}_{\texttt{внутренняя гипотеза}}\]</span></p>
<p>Видно, данные выражения отличаются лишь знаком (в случае внутренней гипотезы появляется минус) и вычисляемой функцией (ковариация заменяется на вариограмму при переходе к внутренней гипотезе).</p>
<p>Таким образом, получаем важнейший вывод, необходимый для решения системы уравнений обычного кригинга, рассматриваемых в следующем параграфе:</p>
<blockquote>
<p><strong>При соблюдении внутренней гипотезы в уравнениях кригинга можно принять</strong> <span class="math inline">\(\sigma_{ij} = -\gamma_{ij}\)</span></p>
</blockquote>
<p>Следствием этого также является то, что дисперсия <em>допустимой линейной комбинации</em> может быть выражена через вариограмму:</p>
<p><span class="math display">\[\Var \Bigg[\sum_{i=1}^N \lambda_i Z(x_i)\Bigg] = - \sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j \gamma(x_j - x_i)\]</span></p>
<p>Функция <span class="math inline">\(G(h)\)</span>, для которой при условии и <span class="math inline">\(\sum_{i=1}^N \lambda_i = 0\)</span> выражение <span class="math inline">\(\sum_{i=1}^N \sum_{j=1}^N \lambda_i \lambda_j G(x_j - x_i)\)</span> принимает неотрицательные значения, называется <strong>условно положительно определенной</strong>.</p>
<blockquote>
<p><span class="math inline">\(-\gamma(h)\)</span> — условно положительно определенная ф.</p>
</blockquote>
</div>
</div>
<div id="обычный-кригинг" class="section level3" number="3.4.5">
<h3>
<span class="header-section-number">3.4.5</span> Обычный кригинг<a class="anchor" aria-label="anchor" href="#%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3"><i class="fas fa-link"></i></a>
</h3>
<p>Пусть дано неизвестное среднее <span class="math inline">\(m(x) = a_0\)</span>. Необходимо произвести линейную оценку <span class="math inline">\(Z^* = \sum_{i} \lambda_i Z_i + \lambda_0\)</span>. Выразим среднюю квадратическую ошибку:</p>
<p><span class="math display">\[\E\big[(Z^* - Z_0)^2\big] = \Var[Z^* - Z_0] + \big(\E[Z^* - Z_0]\big)^2 =\\
= \Var[Z^* - Z_0] + \Bigg[\E\bigg[\sum_{i} \lambda_i Z_i + \lambda_0\bigg] - \E\big[Z_0\big] \Bigg]^2 =\\= \Var[Z^* - Z_0] + \Bigg[\underbrace{\E[\lambda_0]}_{\lambda_0} + \sum_{i} \lambda_i \underbrace{\E\big[Z_i\big]}_{a_0} - \underbrace{\E\big[Z_0\big]}_{a_0} \Bigg]^2 =\\= \Var[Z^* - Z_0] + \Bigg[\lambda_0 + \bigg(\sum_i \lambda_i - 1 \bigg) a_0 \Bigg]^2\]</span></p>
<ul>
<li>Только компонента сдвига <span class="math inline">\(\E[Z^* - Z_0]\)</span> содержит <span class="math inline">\(\lambda_0\)</span>, однако, в отличие от случая простого кригинга, мы не можем минимизировать ее, не зная <span class="math inline">\(a_0\)</span>.</li>
<li>Единственный способ избавиться от <span class="math inline">\(a_0\)</span> заключается в том, чтобы наложить дополнительное условие <span class="math inline">\(\sum \lambda_i - 1 = 0\)</span>
</li>
</ul>
<p>Минимизируем ранее введенную функцию ошибки:</p>
<p><span class="math display">\[\Var[Z^* - Z_0] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}\]</span></p>
<p>Для этого, с учетом дополнительного условия <span class="math inline">\(\sum \lambda_i -1 = 0\)</span> применим метод множителей Лагранжа и построим вспомогательную функцию:</p>
<p><span class="math display">\[Q = \Var[Z^* - Z_0] + 2\mu \bigg(\sum_i \lambda_i - 1 \bigg),\]</span></p>
<p>где <span class="math inline">\(\mu\)</span> – неизвестный множитель Лагранжа.</p>
<p>Для минимизации функции приравняем нулю ее частные производные:</p>
<p><span class="math display">\[\begin{cases}\frac{\partial Q}{\partial \lambda_i} = 2 \sum_j \lambda_j \sigma_{ij} - 2 \sigma_{i0} + 2\mu = 0,~i = 1,...,N,\\
\frac{\partial Q}{\partial \mu} = 2\bigg(\sum_i \lambda_i - 1 \bigg) = 0
\end{cases}\]</span></p>
<p>Имеем <span class="math inline">\(N + 1\)</span> уравнений с <span class="math inline">\(N + 1\)</span> неизвестными:</p>
<p><span class="math display">\[\begin{cases}\sum_j \lambda_j \sigma_{ij} + \mu = \sigma_{i0},~i = 1,...,N,\\
\sum_i \lambda_i = 1
\end{cases}\]</span></p>
<p>Заменяя ковариацию на вариограмму, согласно выводу, полученному в предыдущем параграфе, получаем <strong>систему уравнений обычного кригинга</strong>:</p>
<p><span class="math display">\[\color{red}{\boxed{\color{blue}{\begin{cases}\sum_j \lambda_j \gamma_{ij} - \mu = \gamma_{i0},\color{gray}{~i = 1,...,N,}\\
\sum_i \lambda_i = 1
\end{cases}}}}\]</span></p>
<blockquote>
<p>Обычный (или ординарный) кригинг — наиболее часто используемый геостатистический метод интерполяции.</p>
</blockquote>
</div>
<div id="дисперсия-обычного-кригинга" class="section level3" number="3.4.6">
<h3>
<span class="header-section-number">3.4.6</span> Дисперсия обычного кригинга<a class="anchor" aria-label="anchor" href="#%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D0%BE%D0%B3%D0%BE-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3%D0%B0"><i class="fas fa-link"></i></a>
</h3>
<p>Вывод формулы для оценки дисперсии обычного кригинга выполняется аналогично случаю простого кригинга. Умножим <span class="math inline">\(N\)</span> первых уравнений на <span class="math inline">\(\lambda_i\)</span>, просуммируем их по <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[\sum_j \lambda_j \gamma_{ij} - \mu = \gamma_{i0}~\Bigg|\times \lambda_i\]</span></p>
<p>Учтя дополнительное условие <span class="math inline">\(\sum_i \lambda_i = 1\)</span>, получаем выражение для оценки дисперсии (ошибки) обычного кригинга:</p>
<p><span class="math display">\[\color{red}{\boxed{\color{blue}{\sigma_{OK} = Var[Z^* - Z_0] = \sum_{i}\lambda_i\gamma_{i0} - \mu}}}\]</span></p>
</div>
<div id="универсальный-кригинг" class="section level3" number="3.4.7">
<h3>
<span class="header-section-number">3.4.7</span> Универсальный кригинг<a class="anchor" aria-label="anchor" href="#%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3"><i class="fas fa-link"></i></a>
</h3>
<p>В методе универсального кригинга осуществляется декомпозиция переменной <span class="math inline">\(Z(x)\)</span> в виде следующей суммы:</p>
<p><span class="math display">\[Z(x) = m(x) + Y(x)\]</span></p>
<ul>
<li><p><span class="math inline">\(m(x)\)</span> — <strong>дрифт</strong> (<em>drift</em>), гладкая детерминированная функция, описывающая <em>систематическую</em> составляющую пространственной изменчивости явления;</p></li>
<li><p><span class="math inline">\(Y(x)\)</span> - <strong>остаток</strong> (<em>residual</em>), случайная функция с нулевым математическим ожиданием, описывающая <em>случайную</em> составляющую пространственной изменчивости явления;</p></li>
</ul>
<blockquote>
<p>Декомпозиция любого явления на дрифт и остаток зависит от масштаба рассмотрения явления.</p>
</blockquote>
<p>Метод универсального кригинга используется, когда математическое ожидание случайного процесса непостоянно по пространству. Это позволяет интерполировать данные, в которых присутствует тренд.</p>
<p>В предположении, что м.о. имеет функциональную зависимость от других процессов в точке <span class="math inline">\(x\)</span>, вводится следующая модель:</p>
<p><span class="math display">\[m(x) = \sum_{k=0}^{K} a_k f^k(x),\]</span></p>
<p>где <span class="math inline">\(f^k(x)\)</span> — известные <em>базисные функции</em>, а <span class="math inline">\(a_k\)</span> — фиксированные для точки <span class="math inline">\(x\)</span>, но неизвестные коэффициенты.</p>
<ul>
<li><p>Обычно первая базисная функция при <span class="math inline">\(k = 0\)</span> представляет собой константу, равную 1. Это позволяет включить в модель случай постоянного м.о.</p></li>
<li><p>Если среднее зависит только от местоположения, то оставшиеся функции <span class="math inline">\(f^k(x), k &gt; 0\)</span>, как правило, представляют собой одночлены от координат (например, для двумерного случая <span class="math inline">\(f^2(p) = x^2 + y^2\)</span>)</p></li>
<li><p>Коэффициенты <span class="math inline">\(a_k\)</span> могут меняться в зависимости от <span class="math inline">\(x\)</span>, но обязательно медленно, чтобы их можно было считать постоянными в окрестности <span class="math inline">\(x\)</span>.</p></li>
</ul>
<p>В качестве дрифта <span class="math inline">\(m(x)\)</span> можно использовать не только функцию от местоположения, но также значения внешней переменной — <strong>ковариаты</strong>.</p>
<p>Например, количество осадков можно связать с высотой точки <span class="math inline">\(H(x)\)</span> следующей моделью:</p>
<p><span class="math display">\[Z(x) = a_0 + a_1 H(x) + Y(x)\]</span></p>
<p>С статистической точки зрения это линейная регрессия, в которой остатки коррелированы (автокоррелированы).</p>
<blockquote>
<p>В литературе данный метод называют также <strong>регрессионным кригингом</strong> (<em>regression kriging</em>), а оценка дрифта — <strong>пространственной регрессией</strong> (<em>spatial regression</em>).</p>
</blockquote>
<p>Для вывода уравнений рассмотрим среднеквадратическую ошибку:
<span class="math display">\[\E[Z^* - Z_0]^2 = \Var[Z^* - Z_0] + \big(\E[Z^* - Z_0]\big)^2\]</span></p>
<p>Используя введенную модель дрифта <span class="math inline">\(m(x) = \sum_{k=0}^{K} a^k f^k(x)\)</span> распишем выражение для мат.ожидания приращений:</p>
<p><span class="math display">\[\E[Z^* - Z_0] = \E[Z^*\big] - \E[Z_0] = \\
\sum_i \lambda_i \sum_k a_k f_i^k - \sum_k a_k f_0^k = \sum_k a_k \Bigg(\sum_i \lambda_i f_i^k - f_0^k\Bigg)\]</span></p>
<p>Чтобы минимизировать <span class="math inline">\(\E[Z^* - Z_0]\)</span> независимо от коэффициентов <span class="math inline">\(a_k\)</span>, достаточно в вышеприведенной формуле приравнять нулю выражение в скобках. Отсюда имеем:</p>
<p><span class="math display">\[\sum_i \lambda_i f_i^k = f_0^k,~k = 0, 1, ..., K.\]</span></p>
<p>Эти условия называются <strong>условиями универсальности</strong>. Отсюда идет название метода — <em>универсальный кригинг</em></p>
<blockquote>
<p>Условия универсальности гаранируют, что оценка <span class="math inline">\(Z^*\)</span> является <strong>несмещенной</strong> для <em>любых</em> значений <span class="math inline">\(a_k\)</span>.</p>
</blockquote>
<p>Минимизируем ранее введенную функцию ошибки:</p>
<p><span class="math display">\[\Var[Z^* - Z_0] = \sum_{i}\sum_{j} \lambda_i \lambda_j \sigma_{ij} - 2 \sum_{} \lambda_i \sigma_{i0} + \sigma_{00}\]</span></p>
<p>Для этого, с учетом дополнительного условия <span class="math inline">\(\sum_i \lambda_i f_i^k = f_0^k\)</span> применим метод множителей Лагранжа и построим вспомогательную функцию:</p>
<p><span class="math display">\[Q = \Var[Z^* - Z_0] + 2 \sum_{k=0}^K \mu_k \Bigg[ \sum_i \lambda_i f_i^k - f_0^k\Bigg],\]</span></p>
<p>где <span class="math inline">\(\mu_k,~k = 0, 1, ..., K\)</span> представляют <span class="math inline">\(K + 1\)</span> дополнительных неизвестных, множители Лагранжа.</p>
<p>Для минимизации функции приравняем нулю ее частные производные:</p>
<p><span class="math display">\[\begin{cases}\frac{\partial Q}{\partial \lambda_i} = 2 \sum_j \lambda_j \sigma_{ij} -2 \sigma_{i0} + 2 \sum_k \mu_k f_i^k = 0,\color{gray}{~i = 1,...,N,}\\
\frac{\partial Q}{\partial \mu} = 2\bigg[\sum_i \lambda_i f_i^k - f_0^k \bigg] = 0\color{gray}{,~k = 0, 1,..., K.}
\end{cases}\]</span></p>
<p>Имеем систему из <span class="math inline">\(N + K + 1\)</span> уравнений с <span class="math inline">\(N + K + 1\)</span> неизвестными:</p>
<p><span class="math display">\[\begin{cases}\sum_j \lambda_j \sigma_{ij} + \sum_k \mu_k f_i^k = \sigma_{i0},~i = 1,...,N,\\
\sum_i \lambda_i f_i^k = f_0^k,~k = 0, 1,..., K.
\end{cases}\]</span></p>
<p>Заменяя ковариацию на вариограмму, получаем <strong>систему уравнений универсального кригинга</strong>:</p>
<p><span class="math display">\[\color{red}{\boxed{\color{blue}{\begin{cases}\sum_j \lambda_j \gamma_{ij} - \sum_k \mu_k f_i^k = \gamma_{i0},\color{gray}{~i = 1,...,N,}\\
\sum_i \lambda_i f_i^k = f_0^k\color{gray}{,~k = 0, 1,..., K.}
\end{cases}}}}\]</span></p>
</div>
<div id="дисперсия-универсального-кригинга" class="section level3" number="3.4.8">
<h3>
<span class="header-section-number">3.4.8</span> Дисперсия универсального кригинга<a class="anchor" aria-label="anchor" href="#%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3%D0%B0"><i class="fas fa-link"></i></a>
</h3>
<p>Вывод формулы для оценки дисперсии универсального кригинга выполняется аналогично случаю обычного кригинга. Умножим <span class="math inline">\(N\)</span> первых уравнений на <span class="math inline">\(\lambda_i\)</span>, просуммируем их по <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[\sum_j \lambda_j \gamma_{ij} - \sum_k \mu_k f_i^k = \gamma_{i0} ~ \Bigg|\times \lambda_i\]</span></p>
<p>Учтя дополнительное условие <span class="math inline">\(\sum_i \lambda_i f_i^k = f_0^k\)</span>, получаем выражение для оценки дисперсии (ошибки) универсального кригинга:</p>
<p><span class="math display">\[\color{red}{\boxed{\color{blue}{\sigma_{UK} = \E[Z^* - Z_0]^2 = \sum_{i}\lambda_i\gamma_{i0} - \sum_k \mu_k f_0^k}}}\]</span></p>
</div>
<div id="кросс-валидация" class="section level3" number="3.4.9">
<h3>
<span class="header-section-number">3.4.9</span> Кросс-валидация<a class="anchor" aria-label="anchor" href="#%D0%BA%D1%80%D0%BE%D1%81%D1%81-%D0%B2%D0%B0%D0%BB%D0%B8%D0%B4%D0%B0%D1%86%D0%B8%D1%8F"><i class="fas fa-link"></i></a>
</h3>
<p>Значение переменной <span class="math inline">\(Z(x)\)</span> оценивается в каждой точке <span class="math inline">\(x_i\)</span> по данным в соседних точках <span class="math inline">\(Z(x_j), ~ j \neq i\)</span> как если бы <span class="math inline">\(Z(x_i)\)</span> было неизвестно.</p>
<p>В каждой точке вычисляется оценка кригинга <span class="math inline">\(Z_{-i}^*\)</span> и соответствующая дисперсия кригинга <span class="math inline">\(\sigma_{Ki}^2\)</span>. Поскольку значение <span class="math inline">\(Z_i = Z(x_i)\)</span> известно, мы можем вычислить:</p>
<ul>
<li>
<strong>Ошибку кригинга</strong> <span class="math inline">\(E_i = Z_{-i}^* - Z_i\)</span>
</li>
<li>
<strong>Стандартизированную ошибку</strong> <span class="math inline">\(e_i = E_i / \sigma_{Ki}\)</span>
</li>
</ul>
<p>Если <span class="math inline">\(\gamma(h)\)</span> — теоретическая вариограмма, то <span class="math inline">\(E_i = Z_{-i}^* - Z_i\)</span> — случайная величина с м.о. = <span class="math inline">\(0\)</span> и дисперсией <span class="math inline">\(\sigma_{K_i}^2\)</span>, а <span class="math inline">\(e_i\)</span> имеет м.о. = <span class="math inline">\(0\)</span> и дисперсию, равную <span class="math inline">\(1\)</span>.</p>
<p>Стандартно анализируются следующие карты и графики:</p>
<ul>
<li><p><em>Карта стандартизированных ошибок</em> <span class="math inline">\(e_i\)</span>. Стационарность ошибок, отсутствие эффекта пропорциональности.</p></li>
<li><p><em>Гистограмма стандартизированных ошибок</em> <span class="math inline">\(e_i\)</span>. Нормальность распределения, отсутствие аномалий.</p></li>
<li><p><em>Диаграмма рассеяния</em> <span class="math inline">\((Z_{-i}^*, Z_i)\)</span>. Сглаживающий эффект, соответствие оценки и реального значения.</p></li>
<li><p><em>Диаграмма рассеяния</em> <span class="math inline">\((Z_{-i}^*, e_i)\)</span>. Независимость (ортогональность) оценки и ошибки.</p></li>
</ul>
</div>
<div id="вариограмма" class="section level3" number="3.4.10">
<h3>
<span class="header-section-number">3.4.10</span> Вариограмма<a class="anchor" aria-label="anchor" href="#%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Вариограмма</strong> <em>(полувариограмма)</em> дисперсия разности значений в точках как функция от их взаимного положения:</p>
<p><span class="math display">\[\gamma (h) = \gamma(x, x + h) = \E\big[Z(x + h)-Z(x)\big]^2\]</span></p>
<p>Для <span class="math inline">\(N\)</span> точек, разделенных вектором <span class="math inline">\(\mathbf{h}\)</span>:</p>
<p><span class="math display">\[\gamma(h) = \frac{1}{2N(h)}\sum_{i=1}^{N(\mathbf{h})} \big[Z(x_i) - Z(x_i + h)\big]^2\]</span></p>
<p>Свойства вариограммы:</p>
<ul>
<li>
<p>Вариограмма симметрична:</p>
<p><span class="math display">\[\gamma(x) = \gamma(-x)\]</span></p>
</li>
<li>
<p>Вариограмма связана с дисперсией:</p>
<p><span class="math display">\[\gamma(\infty) = \Var\big[ Z(x) \big]\]</span></p>
</li>
<li>
<p>Вариограмма связана с ковариацией:</p>
<p><span class="math display">\[\gamma(h) = \Var\big[ Z(x) \big] - C(h)\]</span></p>
</li>
<li><p>Вариограмма чувствительна к аномальным значениям (по причине второй степени)</p></li>
</ul>
</div>
<div id="модели-вариограмм" class="section level3" number="3.4.11">
<h3>
<span class="header-section-number">3.4.11</span> Модели вариограмм<a class="anchor" aria-label="anchor" href="#%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8-%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC"><i class="fas fa-link"></i></a>
</h3>
<p>В уравнениях кригинга нельзя использовать эмпирическую вариограмму. Это связано с тем, что вывод этих уравнений опирается на предположение, что вариограмма представляет собой <em>условно положительно определенную функцию</em>. Поэтому следующим шагом после вычисления эмпирической вариограммы является подбор теоретической модели, которая наилучшим образом аппроксимирует эмпирическу функцию, и при этом отвечает требованию условной положительной определенности. Рассмотрим несколько распространенных на практике моделей.</p>
</div>
<div id="сферическая-модель" class="section level3" number="3.4.12">
<h3>
<span class="header-section-number">3.4.12</span> Сферическая модель<a class="anchor" aria-label="anchor" href="#%D1%81%D1%84%D0%B5%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C"><i class="fas fa-link"></i></a>
</h3>
<p><span class="math display">\[\gamma(h) = \begin{cases}
  c_0 + c\Big[\frac{3h}{2a} - \frac{1}{2}\big(\frac{h}{a}\big)^3\Big], &amp; h \leq a; \\
  c_0 + c, &amp; h &gt; a.
\end{cases}\]</span></p>
<p><span class="math display">\[\gamma(a) = \Var\big[Z(p)\big] = c_0 + c\]</span></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fl">60</span>
<span class="va">a</span> <span class="op">=</span> <span class="fl">40</span>
<span class="va">h</span> <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">n</span>

<span class="va">tab</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  h <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">60</span>,
  gamma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">a</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">a</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="va">a</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">-</span><span class="va">a</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="va">tab</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">h</span>, <span class="va">gamma</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">'steelblue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">a</span>, color <span class="op">=</span> <span class="st">'orangered'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="fl">3</span>, y <span class="op">=</span> <span class="fl">0.5625</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"a ="</span>, <span class="va">a</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'orangered'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Данная модель достигает плато в точке <span class="math inline">\(h = a\)</span>.</p>
</div>
<div id="экспоненциальная-модель" class="section level3" number="3.4.13">
<h3>
<span class="header-section-number">3.4.13</span> Экспоненциальная модель<a class="anchor" aria-label="anchor" href="#%D1%8D%D0%BA%D1%81%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C"><i class="fas fa-link"></i></a>
</h3>
<p><span class="math display">\[\gamma(h) = \begin{cases}
  0, &amp; h = 0; \\
  c_0 + (c-c_0)\Big[1 - \exp\big(\frac{-3h}{a}\big)\Big], &amp; h \neq 0.
\end{cases}\]</span></p>
<p><span class="math display">\[\gamma(a) = \Var\big[Z(p)\big] = c_0 + c\]</span></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  h <span class="op">=</span> <span class="va">h</span>,
  gamma <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">*</span><span class="va">h</span><span class="op">/</span><span class="va">a</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">pl</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="va">tab</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">h</span>, <span class="va">gamma</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">'steelblue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">a</span>, color <span class="op">=</span> <span class="st">'orangered'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="fl">3</span>, y <span class="op">=</span> <span class="fl">0.5625</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"a ="</span>, <span class="va">a</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'orangered'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="op">(</span><span class="va">pl</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"></div>
<ul>
<li>Данная модель достигает плато асимптотически.</li>
<li>В точке <span class="math inline">\(h = a\)</span> достигается <span class="math inline">\(95\%\)</span> уровня плато.</li>
</ul>
</div>
<div id="гауссова-модель" class="section level3" number="3.4.14">
<h3>
<span class="header-section-number">3.4.14</span> Гауссова модель<a class="anchor" aria-label="anchor" href="#%D0%B3%D0%B0%D1%83%D1%81%D1%81%D0%BE%D0%B2%D0%B0-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C"><i class="fas fa-link"></i></a>
</h3>
<p><span class="math display">\[\gamma(h) = c_0 + c\Bigg[1 - \exp\bigg(\frac{-3h^2}{a^2}\bigg)\Bigg]\]</span></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  h <span class="op">=</span> <span class="va">h</span>,
  gamma <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">*</span><span class="va">h</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">a</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">pl</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="va">tab</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">h</span>, <span class="va">gamma</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">'steelblue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">a</span>, color <span class="op">=</span> <span class="st">'orangered'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="fl">3</span>, y <span class="op">=</span> <span class="fl">0.5625</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"a ="</span>, <span class="va">a</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'orangered'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="op">(</span><span class="va">pl</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;"></div>
<ul>
<li>Данная модель достигает плато асимптотически.</li>
<li>В точке <span class="math inline">\(h = a\)</span> достигается <span class="math inline">\(95\%\)</span> уровня плато.</li>
<li>Отличительной чертой этой модели является ее гладкость: параболическое поведение вблизи нуля и асимптотическое приближение к плато.</li>
</ul>
</div>
<div id="степенная-модель" class="section level3" number="3.4.15">
<h3>
<span class="header-section-number">3.4.15</span> Степенная модель<a class="anchor" aria-label="anchor" href="#%D1%81%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C"><i class="fas fa-link"></i></a>
</h3>
<p><span class="math display">\[\gamma(h) = \begin{cases}
  0, &amp; h = 0; \\
  c h^\alpha, &amp; h \neq 0.
\end{cases}\]</span></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  h <span class="op">=</span> <span class="va">h</span>,
  gamma <span class="op">=</span> <span class="va">h</span><span class="op">^</span><span class="fl">1.5</span>
<span class="op">)</span>

<span class="va">pl</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="va">tab</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">h</span>, <span class="va">gamma</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">'steelblue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="op">(</span><span class="va">pl</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;"></div>
<ul>
<li>Автокорреляция присутствует на всех расстояниях: <span class="math inline">\(a \rightarrow \infty\)</span>
</li>
<li>Предположение о стационарности второго порядка не выполняется</li>
<li>Как правило, это означает наличие тренда в данных</li>
</ul>
</div>
<div id="эффект-самородка-модель-наггет" class="section level3" number="3.4.16">
<h3>
<span class="header-section-number">3.4.16</span> Эффект самородка (модель наггет)<a class="anchor" aria-label="anchor" href="#%D1%8D%D1%84%D1%84%D0%B5%D0%BA%D1%82-%D1%81%D0%B0%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BA%D0%B0-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C-%D0%BD%D0%B0%D0%B3%D0%B3%D0%B5%D1%82"><i class="fas fa-link"></i></a>
</h3>
<p><span class="math display">\[\gamma(h) = \begin{cases}
  0, &amp; h = 0; \\
  c_0, &amp; h \neq 0.
\end{cases}, ~ c_0 = C(0)\]</span></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  gamma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,
  h <span class="op">=</span> <span class="va">h</span>
<span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="va">tab</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">h</span>, <span class="va">gamma</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">'steelblue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">21</span>,
             colour <span class="op">=</span> <span class="st">'steelblue'</span>, fill <span class="op">=</span> <span class="st">'white'</span>, size <span class="op">=</span> <span class="fl">3</span>, stroke <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">'point'</span>, x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">'steelblue'</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/sam-1.png" width="100%" style="display: block; margin: auto;"></div>
<ul>
<li>Наличие у данных вариограммы типа наггет означает отсутствие пространственной корреляции.</li>
<li>Возможные причины:
<ul>
<li>Абсолютно случайное распределение</li>
<li>Мелкомасштабная вариабельность (меньше, чем расстояние между измерениями)</li>
<li>Ошибки в измерениях</li>
<li>Ошибки в координатах точек</li>
</ul>
</li>
</ul>
</div>
<div id="диаграмма-рассеяния-с-лагом" class="section level3" number="3.4.17">
<h3>
<span class="header-section-number">3.4.17</span> Диаграмма рассеяния с лагом<a class="anchor" aria-label="anchor" href="#%D0%B4%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0-%D1%80%D0%B0%D1%81%D1%81%D0%B5%D1%8F%D0%BD%D0%B8%D1%8F-%D1%81-%D0%BB%D0%B0%D0%B3%D0%BE%D0%BC"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Lagged scatterplot</strong> — вариант диаграммы рассеяния, на котором показываются значения в точках, расстояние между которыми попадает в заданный интервал</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span>

<span class="va">cities</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/Italy_Cities.gpkg"</span><span class="op">)</span>
<span class="co">## Reading layer `Italy_Cities' from data source </span>
<span class="co">##   `/Users/tsamsonov/GitHub/r-spatstat-course/data/Italy_Cities.gpkg' </span>
<span class="co">##   using driver `GPKG'</span>
<span class="co">## Simple feature collection with 8 features and 37 fields</span>
<span class="co">## Geometry type: POINT</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: 368910.4 ymin: 4930119 xmax: 686026 ymax: 5115936</span>
<span class="co">## Projected CRS: WGS 84 / UTM zone 32N</span>

<span class="va">rainfall</span> <span class="op">=</span> <span class="fu">read_table2</span><span class="op">(</span><span class="st">"data/Rainfall.dat"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'x'</span>, <span class="st">'y'</span><span class="op">)</span>, 
           crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">cities</span><span class="op">)</span>,
           remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">hscat</span><span class="op">(</span><span class="va">rain_24</span><span class="op">~</span><span class="fl">1</span>, data <span class="op">=</span> <span class="va">rainfall</span>, <span class="fl">1000</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="вариограммное-облако" class="section level3" number="3.4.18">
<h3>
<span class="header-section-number">3.4.18</span> Вариограммное облако<a class="anchor" aria-label="anchor" href="#%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%BE%D0%B5-%D0%BE%D0%B1%D0%BB%D0%B0%D0%BA%D0%BE"><i class="fas fa-link"></i></a>
</h3>
<p>Квадрат разности значений как функция от расстояния между точками</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">varcl</span> <span class="op">=</span> <span class="fu">variogram</span><span class="op">(</span><span class="va">rain_24</span><span class="op">~</span><span class="fl">1</span>, data<span class="op">=</span><span class="va">rainfall</span>, cutoff <span class="op">=</span> <span class="fl">150000</span>, cloud<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">varcl</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">dist</span>, <span class="va">gamma</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">'steelblue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="st">'semivariance'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-7-1.png" width="100%"></div>
</div>
<div id="эмпирическая-вариограмма" class="section level3" number="3.4.19">
<h3>
<span class="header-section-number">3.4.19</span> Эмпирическая вариограмма<a class="anchor" aria-label="anchor" href="#%D1%8D%D0%BC%D0%BF%D0%B8%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0"><i class="fas fa-link"></i></a>
</h3>
<p>Эмпирическая вариограмма рассчитывается путем разбения вариограммного облака на интервалы расстояний — <strong>лаги</strong> — и подсчета среднего значения <span class="math inline">\(\gamma\)</span> в каждом лаге по следующей формуле:</p>
<p><span class="math display">\[\hat{\gamma} = \frac{1}{2N_h} \sum_{x_i - x_j \approx h} \big[z(x_i) - z(x_j)\big]^2\]</span></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">width</span> <span class="op">=</span> <span class="fl">10000</span>
<span class="va">intervals</span> <span class="op">=</span> <span class="va">width</span> <span class="op">*</span> <span class="fl">0</span><span class="op">:</span><span class="fl">15</span>

<span class="va">vargr</span> <span class="op">=</span> <span class="fu">variogram</span><span class="op">(</span><span class="va">rain_24</span><span class="op">~</span><span class="fl">1</span>, data<span class="op">=</span><span class="va">rainfall</span>, cutoff <span class="op">=</span> <span class="fl">150000</span>, width <span class="op">=</span> <span class="va">width</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-9-1.png" width="100%"></div>
<p>Оставив только вариограмму, получим:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="va">vargr</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">dist</span>, <span class="va">gamma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="va">vargr</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">dist</span>, <span class="va">gamma</span>, size <span class="op">=</span> <span class="va">np</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_size</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure">
<img src="03-Geostatistics_files/figure-html/unnamed-chunk-10-1.png" width="100%">
Размер точки означает количество пар значений, которые попали в каждый лаг.</div>
<p>Поскольку вариограмма есть <em>дисперсия разности значений</em>, ее рост при увеличении расстояния можно оценить также по увеличению размера «ящика» на диаграмме размаха <span class="math inline">\(\sqrt\gamma\)</span>:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">varcl</span> <span class="op">=</span> <span class="va">varcl</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>sqgamma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span>,
         lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">dist</span>, breaks <span class="op">=</span> <span class="va">intervals</span>, labels <span class="op">=</span> <span class="fl">0.001</span> <span class="op">*</span> <span class="op">(</span><span class="va">intervals</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">width</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">varcl</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">lag</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span><span class="op">)</span>, outlier.alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-11-1.png" width="100%"></div>
</div>
<div id="вариокарта" class="section level3" number="3.4.20">
<h3>
<span class="header-section-number">3.4.20</span> Вариокарта<a class="anchor" aria-label="anchor" href="#%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%BA%D0%B0%D1%80%D1%82%D0%B0"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Вариокарта</strong> (<em>variogram map, variomap</em>) представляет вариограмму как функцию приращений координат:
<span class="math display">\[\hat{\gamma} (\Delta x, \Delta y) = \frac{1}{2N_{\substack{\Delta x\\ \Delta y}}} \sum_{\substack{\Delta x_{ij} \approx \Delta x\\ \Delta y_{ij} \approx \Delta y}} \big[z(p_i) - z(p_j)\big]^2\]</span></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">varmp</span> <span class="op">=</span> <span class="fu">variogram</span><span class="op">(</span><span class="va">rain_24</span><span class="op">~</span><span class="fl">1</span>, data<span class="op">=</span><span class="va">rainfall</span>, cutoff <span class="op">=</span> <span class="fl">150000</span>, width <span class="op">=</span> <span class="va">width</span>, map <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="st">'map'</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-13-1.png" width="100%"></div>
<p>Вариокарта используется для выявления <em>пространственной анизотропии</em>. Профиль по линии из центра к краю вариокарты даст эмпирическую вариограмму</p>
</div>
<div id="приближение-теоретической-модели" class="section level3" number="3.4.21">
<h3>
<span class="header-section-number">3.4.21</span> Приближение теоретической модели<a class="anchor" aria-label="anchor" href="#%D0%BF%D1%80%D0%B8%D0%B1%D0%BB%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-%D1%82%D0%B5%D0%BE%D1%80%D0%B5%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B9-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Приближение</strong> (<em>fitting</em>) модели вариограммы предполагает:</p>
<ol style="list-style-type: decimal">
<li>Выбор теоретической модели</li>
<li>Подбор параметров модели: эффект самородка (nugget), радиус корреляции и плато.</li>
</ol>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-14-1.png" width="100%"></div>
<p>Дана вариограмма семейства <span class="math inline">\(\gamma (h; \mathbf{b})\)</span>, где <span class="math inline">\(\mathbf{b} = (b_1, ..., b_k)\)</span> — вектор из <span class="math inline">\(k\)</span> параметров модели. Параметры <span class="math inline">\(\mathbf{b}\)</span> подбираются таким образом, чтобы минимизировать следующий функционал:</p>
<p><span class="math display">\[Q(\mathbf{b}) = \sum_{l=1}^{L} w_l \big[\hat{\gamma}(h_l) - \gamma (h; \mathbf{b})\big]^2,\]</span></p>
<p>где <span class="math inline">\(\big\{\hat{\gamma} (h_l): l = 1,...,L\big\}\)</span> — значения эмпирической вариограммы для <span class="math inline">\(L\)</span> лагов, вычисленные по <span class="math inline">\(N(h_l)\)</span> векторам.</p>
<p>Веса <span class="math inline">\(w_l\)</span> обычно выбираются исходя из отношения <span class="math inline">\(w_l = N(h_l) / |h_l|\)</span>, чтобы придать большее значение коротким расстояниям и лагам с хорошей оценкой.</p>
<p>Минимизация функционала осуществляется итеративно:</p>
<ol style="list-style-type: decimal">
<li>Процесс начинается с некоторого предположения <span class="math inline">\(\mathbf{b}^{(0)}\)</span>
</li>
<li>На шаге <span class="math inline">\(s\)</span> функция <span class="math inline">\(Q\)</span> аппроксимируется в виде квадратичной формы <span class="math inline">\(Q(\mathbf{b}^{(s)}) \approx \sum_{i=1}^k \sum_{j=1}^k \delta_{ij} b_i b_j\)</span> путем разложения в ряд Тейлора вокруг точки <span class="math inline">\(\mathbf{b}^{(s)}\)</span>.</li>
<li>Новая точка минимума <span class="math inline">\(\mathbf{b}^{(s+1)}\)</span> находится как минимум квадратичной формы (<em>этот минимум один</em>).</li>
</ol>
<p>Шаги 2-3 повторяются до тех пор, пока значение <span class="math inline">\(Q\)</span> не станет меньше заданного порога.</p>
<p>Сравним результат ручного и автоматического приближения вариограммы:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">varmd</span> <span class="op">=</span> <span class="fu">fit.variogram</span><span class="op">(</span><span class="va">vargr</span>, model <span class="op">=</span> <span class="fu">vgm</span><span class="op">(</span>psill <span class="op">=</span> <span class="fl">215</span>, model <span class="op">=</span> <span class="st">'Sph'</span>, range <span class="op">=</span> <span class="fl">120000</span>, nugget <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span>

<span class="va">h0</span> <span class="op">=</span> <span class="va">lag</span> <span class="op">*</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">varmd</span><span class="op">[</span><span class="fl">2</span>, <span class="st">'range'</span><span class="op">]</span><span class="op">/</span><span class="va">lag</span><span class="op">)</span>
<span class="va">h1</span> <span class="op">=</span> <span class="va">lag</span> <span class="op">*</span> <span class="op">(</span><span class="va">varmd</span><span class="op">[</span><span class="fl">2</span>, <span class="st">'range'</span><span class="op">]</span><span class="op">/</span><span class="va">lag</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">cutoff</span><span class="op">/</span><span class="va">lag</span><span class="op">)</span> 

<span class="va">tab2</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">h0</span>, <span class="va">h1</span><span class="op">)</span>,
  gamma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">varmd</span><span class="op">[</span><span class="fl">1</span>, <span class="st">'psill'</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">varmd</span><span class="op">[</span><span class="fl">2</span>, <span class="st">'psill'</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="va">h0</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">varmd</span><span class="op">[</span><span class="fl">2</span>, <span class="st">'range'</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">h0</span> <span class="op">/</span> <span class="va">varmd</span><span class="op">[</span><span class="fl">2</span>, <span class="st">'range'</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">varmd</span><span class="op">[</span><span class="fl">1</span>, <span class="st">'psill'</span><span class="op">]</span> <span class="op">+</span> <span class="va">varmd</span><span class="op">[</span><span class="fl">2</span>, <span class="st">'psill'</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">h1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  fit <span class="op">=</span> <span class="st">'automatic'</span>
<span class="op">)</span>

<span class="va">tab</span> <span class="op">=</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">tab1</span>, <span class="va">tab2</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="va">vargr</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">dist</span>, <span class="va">gamma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="va">vargr</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">dist</span>, <span class="va">gamma</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_size</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="va">tab</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span><span class="va">h</span>, <span class="va">gamma</span>, color <span class="op">=</span> <span class="va">fit</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">xlab</span><span class="op">(</span><span class="st">'lag'</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">'gamma'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">'Сферическая модель'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-15-1.png" width="100%"></div>
</div>
<div id="обычный-кригинг-1" class="section level3" number="3.4.22">
<h3>
<span class="header-section-number">3.4.22</span> Обычный кригинг<a class="anchor" aria-label="anchor" href="#%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3-1"><i class="fas fa-link"></i></a>
</h3>
<p>Рассмотрим данные по температуре:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">box</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="va">rainfall</span><span class="op">)</span>
<span class="va">envelope</span> <span class="op">=</span> <span class="va">box</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>

<span class="va">px_grid</span> <span class="op">=</span> <span class="fu">st_as_stars</span><span class="op">(</span><span class="va">box</span>, dx <span class="op">=</span> <span class="fl">2000</span>, dy <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rainfall</span>, color <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">px_grid</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-16-1.png" width="100%"></div>
</div>
<div id="обычный-кригинг-2" class="section level3" number="3.4.23">
<h3>
<span class="header-section-number">3.4.23</span> Обычный кригинг<a class="anchor" aria-label="anchor" href="#%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3-2"><i class="fas fa-link"></i></a>
</h3>
<p>Визуализируем найденную вариограмму и вариокарту:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">vargr</span>, model <span class="op">=</span> <span class="va">varmd</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-17-1.png" width="100%"></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">varmp</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-17-2.png" width="100%"></div>
<p>Проинтерполируем, используя приближенную модель вариограммы:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">px_grid</span> <span class="op">=</span> <span class="fu">krige</span><span class="op">(</span><span class="va">rain_24</span><span class="op">~</span><span class="fl">1</span>, <span class="va">rainfall</span>, <span class="va">px_grid</span>, model <span class="op">=</span> <span class="va">varmd</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [using ordinary kriging]</span>
<span class="co">## stars object with 2 dimensions and 2 attributes</span>
<span class="co">## attribute(s):</span>
<span class="co">##                  Min.   1st Qu.   Median     Mean  3rd Qu.      Max.</span>
<span class="co">## var1.pred  -0.4091735  7.707571 18.83325 21.50978 32.07393  67.26636</span>
<span class="co">## var1.var   30.9929191 45.435980 52.71968 58.67491 65.48474 186.22488</span>
<span class="co">## dimension(s):</span>
<span class="co">##   from  to  offset delta                refsys point values x/y</span>
<span class="co">## x    1 213  332239  2000 WGS 84 / UTM zone 32N    NA   NULL [x]</span>
<span class="co">## y    1  99 5121556 -2000 WGS 84 / UTM zone 32N    NA   NULL [y]</span></code></pre></div>
</div>
<div id="оценка-и-дисперсия-кригинга" class="section level3" number="3.4.24">
<h3>
<span class="header-section-number">3.4.24</span> Оценка и дисперсия кригинга<a class="anchor" aria-label="anchor" href="#%D0%BE%D1%86%D0%B5%D0%BD%D0%BA%D0%B0-%D0%B8-%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3%D0%B0"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rain_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"dodgerblue4"</span><span class="op">)</span><span class="op">)</span>
<span class="va">rain_levels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">80</span>,by<span class="op">=</span><span class="fl">10</span><span class="op">)</span>
<span class="va">rain_ncolors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rain_levels</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>

<span class="va">err_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"coral"</span>, <span class="st">"violetred"</span><span class="op">)</span><span class="op">)</span>
<span class="va">err_levels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">180</span>, by <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">err_ncolors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">err_levels</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>

<span class="va">cont</span> <span class="op">=</span> <span class="fu">st_contour</span><span class="op">(</span><span class="va">px_grid</span><span class="op">[</span><span class="st">'var1.pred'</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">rain_levels</span>, contour_lines <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">conterr</span> <span class="op">=</span> <span class="fu">st_contour</span><span class="op">(</span><span class="va">px_grid</span><span class="op">[</span><span class="st">'var1.var'</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">err_levels</span>, contour_lines <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">px_grid</span><span class="op">[</span><span class="st">'var1.pred'</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">rain_levels</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'мм'</span>,
                    values <span class="op">=</span> <span class="fu">rain_colors</span><span class="op">(</span><span class="va">rain_ncolors</span><span class="op">)</span>,
                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">rain_levels</span><span class="op">[</span><span class="op">-</span><span class="va">rain_ncolors</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">rain_levels</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,
                    drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">rainfall</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">cont</span>, color <span class="op">=</span> <span class="st">'black'</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rainfall</span>, color <span class="op">=</span> <span class="st">'black'</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-19-1.png" width="100%"></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">px_grid</span><span class="op">[</span><span class="st">'var1.var'</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">err_levels</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'мм'</span>,
                    values <span class="op">=</span> <span class="fu">err_colors</span><span class="op">(</span><span class="va">err_ncolors</span><span class="op">)</span>,
                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">err_levels</span><span class="op">[</span><span class="op">-</span><span class="va">err_ncolors</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">err_levels</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,
                    drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">rainfall</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">conterr</span>, color <span class="op">=</span> <span class="st">'black'</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rainfall</span>, color <span class="op">=</span> <span class="st">'black'</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-19-2.png" width="100%"></div>
<p>Дисперсия кригинга высока там, где мало данных.</p>
</div>
<div id="кросс-валидация-1" class="section level3" number="3.4.25">
<h3>
<span class="header-section-number">3.4.25</span> Кросс-валидация<a class="anchor" aria-label="anchor" href="#%D0%BA%D1%80%D0%BE%D1%81%D1%81-%D0%B2%D0%B0%D0%BB%D0%B8%D0%B4%D0%B0%D1%86%D0%B8%D1%8F-1"><i class="fas fa-link"></i></a>
</h3>
<p>Для выполнения кросс-валидации воспользуемся функцией <code>krige.cv</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cvl</span> <span class="op">=</span> <span class="fu">krige.cv</span><span class="op">(</span><span class="va">rain_24</span><span class="op">~</span><span class="fl">1</span>, <span class="va">rainfall</span>, <span class="va">varmd</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>sterr <span class="op">=</span> <span class="va">residual</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var1.var</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cvl</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_set_geometry</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="co">##    var1.pred var1.var observed     residual      zscore fold       sterr</span>
<span class="co">## 1   5.743730 34.84033      6.0   0.25627005  0.04341669    1  0.04341669</span>
<span class="co">## 2  11.137129 60.24070     10.0  -1.13712865 -0.14650910    2 -0.14650910</span>
<span class="co">## 3   6.929502 47.22732      7.0   0.07049833  0.01025846    3  0.01025846</span>
<span class="co">## 4  23.252858 48.06354      1.0 -22.25285758 -3.20979954    4 -3.20979954</span>
<span class="co">## 5  15.655167 56.76258      1.0 -14.65516724 -1.94517957    5 -1.94517957</span>
<span class="co">## 6  11.794241 44.03055      1.0 -10.79424095 -1.62672846    6 -1.62672846</span>
<span class="co">## 7  11.325378 62.65261      0.1 -11.22537769 -1.41818009    7 -1.41818009</span>
<span class="co">## 8  28.421330 75.24988      0.2 -28.22133030 -3.25330355    8 -3.25330355</span>
<span class="co">## 9   2.340115 58.30350      1.0  -1.34011550 -0.17550719    9 -0.17550719</span>
<span class="co">## 10  3.489972 62.96551      0.2  -3.28997242 -0.41461106   10 -0.41461106</span></code></pre></div>
<p>Cтандартизированные ошибки в стационарном случае должны быть распределены нормально:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">cvl</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sterr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">'grey'</span>, color <span class="op">=</span> <span class="st">'black'</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'olivedrab'</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-21-1.png" width="100%"></div>
<p>Ошибки должны быть независимы от значений:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">cvl</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var1.pred</span>, <span class="va">sterr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-22-1.png" width="100%"></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sterr</span> <span class="op">+</span> <span class="va">var1.pred</span>, data <span class="op">=</span> <span class="va">cvl</span><span class="op">)</span>
<span class="co">## </span>
<span class="co">##  Pearson's product-moment correlation</span>
<span class="co">## </span>
<span class="co">## data:  sterr and var1.pred</span>
<span class="co">## t = -0.084465, df = 253, p-value = 0.9328</span>
<span class="co">## alternative hypothesis: true correlation is not equal to 0</span>
<span class="co">## 95 percent confidence interval:</span>
<span class="co">##  -0.1280692  0.1176091</span>
<span class="co">## sample estimates:</span>
<span class="co">##          cor </span>
<span class="co">## -0.005310204</span></code></pre></div>
<p>Облако рассеяния оценки относительно истинных значений должно быть компактным:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">cvl</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">var1.pred</span>, <span class="va">observed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-23-1.png" width="100%"></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Диагностика модели линейной регрессии</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">observed</span> <span class="op">~</span> <span class="va">var1.pred</span>, <span class="va">cvl</span><span class="op">)</span><span class="op">)</span>
<span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## lm(formula = observed ~ var1.pred, data = cvl)</span>
<span class="co">## </span>
<span class="co">## Residuals:</span>
<span class="co">##     Min      1Q  Median      3Q     Max </span>
<span class="co">## -47.812  -3.914  -0.505   3.227  32.685 </span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">##             Estimate Std. Error t value            Pr(&gt;|t|)    </span>
<span class="co">## (Intercept) -0.03375    0.93884  -0.036               0.971    </span>
<span class="co">## var1.pred    1.00020    0.03919  25.519 &lt;0.0000000000000002 ***</span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## Residual standard error: 8.405 on 253 degrees of freedom</span>
<span class="co">## Multiple R-squared:  0.7202, Adjusted R-squared:  0.7191 </span>
<span class="co">## F-statistic: 651.2 on 1 and 253 DF,  p-value: &lt; 0.00000000000000022</span></code></pre></div>
<p>Пространственная картина стандартизированных ошибок должна быть гомогенной:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">akima</span><span class="op">)</span>

<span class="va">coords</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">rainfall</span><span class="op">)</span>
<span class="va">coords_grid</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="va">px_grid</span><span class="op">)</span>

<span class="va">px_grid</span> <span class="op">=</span> <span class="va">px_grid</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>sterr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/akima/man/interpp.html">interpp</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">coords</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,
                         y <span class="op">=</span> <span class="va">coords</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,
                         z <span class="op">=</span> <span class="va">cvl</span><span class="op">$</span><span class="va">sterr</span>, 
                         xo <span class="op">=</span> <span class="va">coords_grid</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,
                         yo <span class="op">=</span> <span class="va">coords_grid</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,
                         linear <span class="op">=</span> <span class="cn">FALSE</span>,
                         extrap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">z</span><span class="op">)</span>

<span class="va">sterr_levels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>,<span class="fl">8</span>,<span class="fl">2</span><span class="op">)</span>
<span class="va">sterr_ncolors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sterr_levels</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>
<span class="va">sterr_colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'blue'</span>, <span class="st">'white'</span>, <span class="st">'red'</span><span class="op">)</span><span class="op">)</span>

<span class="va">sterrcont</span> <span class="op">=</span> <span class="fu">st_contour</span><span class="op">(</span><span class="va">px_grid</span><span class="op">[</span><span class="st">'sterr'</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">sterr_levels</span>, contour_lines <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_stars</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">px_grid</span><span class="op">[</span><span class="st">'sterr'</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="va">sterr_levels</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">'мм'</span>,
                    values <span class="op">=</span> <span class="fu">sterr_colors</span><span class="op">(</span><span class="va">sterr_ncolors</span><span class="op">)</span>,
                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">sterr_levels</span><span class="op">[</span><span class="op">-</span><span class="va">sterr_ncolors</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="st">'-'</span>, <span class="va">sterr_levels</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,
                    drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_sf</span><span class="op">(</span>crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">rainfall</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sterrcont</span>, color <span class="op">=</span> <span class="st">'black'</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rainfall</span>, color <span class="op">=</span> <span class="st">'black'</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-Geostatistics_files/figure-html/unnamed-chunk-24-1.png" width="100%"></div>
</div>
</div>
<div id="geostat_review" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Краткий обзор<a class="anchor" aria-label="anchor" href="#geostat_review"><i class="fas fa-link"></i></a>
</h2>
<p>Для просмотра презентации щелкните на ней один раз левой кнопкой мыши и листайте, используя кнопки на клавиатуре:
<iframe src="https://tsamsonov.github.io/r-geo-course/slides/14-Geostatistics_slides.html#1" width="100%" height="500px"></iframe></p>
<blockquote>
<p>Презентацию можно открыть в отдельном окне или вкладке браузере. Для этого щелкните по ней правой кнопкой мыши и выберите соответствующую команду.</p>
</blockquote>
</div>
<div id="geostat_qt" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Контрольные вопросы и упражнения<a class="anchor" aria-label="anchor" href="#geostat_qt"><i class="fas fa-link"></i></a>
</h2>
<div id="geostat_q" class="section level3" number="3.6.1">
<h3>
<span class="header-section-number">3.6.1</span> Вопросы<a class="anchor" aria-label="anchor" href="#geostat_q"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Дайте определения случайной величины, случайного процесса, сечения случайного процесса, реализации случайного процесса. Проиллюстрируйте их примерами.</li>
<li>Сформулируйте определение основных моментов пространственного случайного процесса: математического ожидания, дисперсии и ковариации. Поясните суть этих понятий на конкретных примерах.</li>
<li>Дайте определение стационарности в строгом смысле слова и стационарности второго порядка.</li>
<li>При каком условии случайная функция является изотропной?</li>
<li>Что такое эргодичность? Пояснить суть этого свойства на наглядном примере.</li>
<li>Сформулируйте суть кригинга как метода интерполяции данных. В чем его сходства и отличия в сравнении с методом радиальных базисных функций?</li>
<li>Что из себя представляет среднеквадратическая ошибка, минимизируемая в методе кригинга?</li>
<li>Почему среднеквадратическую ошибку можно считать равной дисперсии в методе простого кригинга?</li>
<li>Что характеризует дисперсия кригинга?</li>
<li>Напишите систему уравнений простого кригинга и выражение для дисперсии простого кригинга.</li>
<li>Дайте определение стационарности приращений. С какой целью вводится данный тип стационарных процессов?</li>
<li>Какие условия должны быть выполнены для того чтобы ковариацию можно было заменить вариограммой в уравнениях кригинга?</li>
<li>Напишите систему уравнений обычного кригинга и выражение для дисперсии обычного кригинга. Чем эти уравнения отличаются от уравнений простого кригинга?</li>
<li>Изложите модель универсального кригинга в математической и словесной форме.</li>
<li>Что такое базисные функции и ковариаты? Какую роль они выполняют в методе универсального кригинга?</li>
<li>Сформулируйте условия универсальности, от которых ведет свое название метод универсального кригинга.</li>
<li>Напишите систему уравнений универсального кригинга и выражение для дисперсии универсального кригинга.</li>
<li>Перечислите стандартный набор действий, применяемых в рамках выполнения процедуры кросс-валидации результатов кригинга.</li>
<li>Что такое вариограмма? Дайте математическое и словесное определение.</li>
<li>Перечислите свойства вариограммы.</li>
<li>Назовите основные модели вариограммы. Какая модель свидетельствует о наличии пространственного тренда в данных?</li>
<li>Чем эмпирическая вариаограмма отличается от теоретической (модели)?</li>
<li>Сформулируйте принципы построения и назначение основных диагностических графиков вариографии: диаграммы рассеяния с лагом, вариограммного облака, эмпирической вариограммы, вариокарты.</li>
<li>Объясните, каким образом можно получить приближение (подгонку) теоретической модели вариограммы под эмпирические данные.</li>
<li>Расскажите об основных возможностях пакета <strong>gstat</strong>. Перечислите функции этого пакета, которые используются для вариографии и интерполяции методом кригинга.</li>
</ol>
</div>
<div id="geostat_t" class="section level3" number="3.6.2">
<h3>
<span class="header-section-number">3.6.2</span> Упражнения<a class="anchor" aria-label="anchor" href="#geostat_t"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Загрузите <a href="https://raw.githubusercontent.com/tsamsonov/r-geo-course/master/data/argo.csv">данные</a> дрейфующих буев <a href="http://www.argo.ucsd.edu/About_Argo.html"><strong>ARGO</strong></a> на акваторию Северной Атлантики за 30 января 2010 года. Постройте поля распределения солености и температуры методом обычного кригинга с размером ячейки 50 км. Подберите подходящую модель вариограммы. Выполните визуализацию оценки кригинга и дисперсии кригинга средствами <strong>ggplot2</strong>. Произведите кросс-валидацию полученных результатов.</p>
<blockquote>
<p><strong>Подсказка:</strong> перед построением сетки интерполяции странсформируйте данные в проекцию <a href="http://spatialreference.org/ref/epsg/wgs-84-world-mercator/"><strong>Меркатора</strong></a>. Чтобы полученное поле распределения покрывало только акваторию, маскируйте полученный растр с использованием слоя <em>ocean</em> из набора данных <strong>Natural Earth</strong>. Перед выполнением маскирования преобразуйте мультиполигон в обычные полигоны (в противном случае маскирование отработает некорректно).</p>
</blockquote>
</li>
</ol>
<div class="inline-table"><table class="table table-sm"><tbody><tr class="odd">
<td>
<em>Самсонов Т.Е.</em> <strong>Пространственная статистика и моделирование на языке R.</strong> М.: Географический факультет МГУ, 2021.</td>
</tr></tbody></table></div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="gwr.html"><span class="header-section-number">2</span> Географически взвешенная регрессия</a></div>
<div class="next"><a href="points.html"><span class="header-section-number">4</span> Точечные паттерны</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#gstat"><span class="header-section-number">3</span> Геостатистика</a></li>
<li><a class="nav-link" href="#%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-1"><span class="header-section-number">3.1</span> Введение</a></li>
<li>
<a class="nav-link" href="#%D0%B1%D0%B0%D0%B7%D0%BE%D0%B2%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BD%D1%8F%D1%82%D0%B8%D1%8F-%D0%B8-%D1%8D%D0%BB%D0%B5%D0%BC%D0%B5%D0%BD%D1%82%D1%8B-%D0%B3%D0%B5%D0%BE%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D0%BA%D0%B8"><span class="header-section-number">3.2</span> Базовые понятия и элементы геостатистики</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%D0%B1%D0%B0%D0%B7%D0%BE%D0%B2%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BD%D1%8F%D1%82%D0%B8%D1%8F"><span class="header-section-number">3.2.1</span> Базовые понятия</a></li>
<li><a class="nav-link" href="#%D1%81%D0%BB%D1%83%D1%87%D0%B0%D0%B9%D0%BD%D1%8B%D0%B9-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81-%D0%B2-%D0%BF%D1%80%D0%BE%D1%81%D1%82%D1%80%D0%B0%D0%BD%D1%81%D1%82%D0%B2%D0%B5-%D0%B8-%D0%B5%D0%B3%D0%BE-%D0%BC%D0%BE%D0%BC%D0%B5%D0%BD%D1%82%D1%8B"><span class="header-section-number">3.2.2</span> Случайный процесс в пространстве и его моменты</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%D1%81%D1%82%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%B8-%D1%8D%D1%80%D0%B3%D0%BE%D0%B4%D0%B8%D1%87%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><span class="header-section-number">3.3</span> Стационарность и эргодичность</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%D1%81%D1%82%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><span class="header-section-number">3.3.1</span> Стационарность</a></li>
<li><a class="nav-link" href="#%D1%8D%D1%80%D0%B3%D0%BE%D0%B4%D0%B8%D1%87%D0%BD%D0%BE%D1%81%D1%82%D1%8C"><span class="header-section-number">3.3.2</span> Эргодичность</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%D0%B3%D0%B5%D0%BE%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5-%D0%BE%D1%86%D0%B5%D0%BD%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5"><span class="header-section-number">3.4</span> Геостатистическое оценивание</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3"><span class="header-section-number">3.4.1</span> Простой кригинг</a></li>
<li><a class="nav-link" href="#%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D0%BF%D1%80%D0%BE%D1%81%D1%82%D0%BE%D0%B3%D0%BE-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3%D0%B0"><span class="header-section-number">3.4.2</span> Дисперсия простого кригинга</a></li>
<li><a class="nav-link" href="#%D1%81%D1%82%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D1%80%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%BF%D1%80%D0%B8%D1%80%D0%B0%D1%89%D0%B5%D0%BD%D0%B8%D0%B9"><span class="header-section-number">3.4.3</span> Стационарность приращений</a></li>
<li><a class="nav-link" href="#%D0%BF%D0%B5%D1%80%D0%B5%D1%85%D0%BE%D0%B4-%D0%BE%D1%82-%D0%BA%D0%BE%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D1%86%D0%B8%D0%B8-%D0%BA-%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B5"><span class="header-section-number">3.4.4</span> Переход от ковариации к вариограмме</a></li>
<li><a class="nav-link" href="#%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3"><span class="header-section-number">3.4.5</span> Обычный кригинг</a></li>
<li><a class="nav-link" href="#%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D0%BE%D0%B3%D0%BE-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3%D0%B0"><span class="header-section-number">3.4.6</span> Дисперсия обычного кригинга</a></li>
<li><a class="nav-link" href="#%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3"><span class="header-section-number">3.4.7</span> Универсальный кригинг</a></li>
<li><a class="nav-link" href="#%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D1%83%D0%BD%D0%B8%D0%B2%D0%B5%D1%80%D1%81%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3%D0%B0"><span class="header-section-number">3.4.8</span> Дисперсия универсального кригинга</a></li>
<li><a class="nav-link" href="#%D0%BA%D1%80%D0%BE%D1%81%D1%81-%D0%B2%D0%B0%D0%BB%D0%B8%D0%B4%D0%B0%D1%86%D0%B8%D1%8F"><span class="header-section-number">3.4.9</span> Кросс-валидация</a></li>
<li><a class="nav-link" href="#%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0"><span class="header-section-number">3.4.10</span> Вариограмма</a></li>
<li><a class="nav-link" href="#%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8-%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC"><span class="header-section-number">3.4.11</span> Модели вариограмм</a></li>
<li><a class="nav-link" href="#%D1%81%D1%84%D0%B5%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C"><span class="header-section-number">3.4.12</span> Сферическая модель</a></li>
<li><a class="nav-link" href="#%D1%8D%D0%BA%D1%81%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C"><span class="header-section-number">3.4.13</span> Экспоненциальная модель</a></li>
<li><a class="nav-link" href="#%D0%B3%D0%B0%D1%83%D1%81%D1%81%D0%BE%D0%B2%D0%B0-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C"><span class="header-section-number">3.4.14</span> Гауссова модель</a></li>
<li><a class="nav-link" href="#%D1%81%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C"><span class="header-section-number">3.4.15</span> Степенная модель</a></li>
<li><a class="nav-link" href="#%D1%8D%D1%84%D1%84%D0%B5%D0%BA%D1%82-%D1%81%D0%B0%D0%BC%D0%BE%D1%80%D0%BE%D0%B4%D0%BA%D0%B0-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C-%D0%BD%D0%B0%D0%B3%D0%B3%D0%B5%D1%82"><span class="header-section-number">3.4.16</span> Эффект самородка (модель наггет)</a></li>
<li><a class="nav-link" href="#%D0%B4%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0-%D1%80%D0%B0%D1%81%D1%81%D0%B5%D1%8F%D0%BD%D0%B8%D1%8F-%D1%81-%D0%BB%D0%B0%D0%B3%D0%BE%D0%BC"><span class="header-section-number">3.4.17</span> Диаграмма рассеяния с лагом</a></li>
<li><a class="nav-link" href="#%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%BE%D0%B5-%D0%BE%D0%B1%D0%BB%D0%B0%D0%BA%D0%BE"><span class="header-section-number">3.4.18</span> Вариограммное облако</a></li>
<li><a class="nav-link" href="#%D1%8D%D0%BC%D0%BF%D0%B8%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0"><span class="header-section-number">3.4.19</span> Эмпирическая вариограмма</a></li>
<li><a class="nav-link" href="#%D0%B2%D0%B0%D1%80%D0%B8%D0%BE%D0%BA%D0%B0%D1%80%D1%82%D0%B0"><span class="header-section-number">3.4.20</span> Вариокарта</a></li>
<li><a class="nav-link" href="#%D0%BF%D1%80%D0%B8%D0%B1%D0%BB%D0%B8%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-%D1%82%D0%B5%D0%BE%D1%80%D0%B5%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B9-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8"><span class="header-section-number">3.4.21</span> Приближение теоретической модели</a></li>
<li><a class="nav-link" href="#%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3-1"><span class="header-section-number">3.4.22</span> Обычный кригинг</a></li>
<li><a class="nav-link" href="#%D0%BE%D0%B1%D1%8B%D1%87%D0%BD%D1%8B%D0%B9-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3-2"><span class="header-section-number">3.4.23</span> Обычный кригинг</a></li>
<li><a class="nav-link" href="#%D0%BE%D1%86%D0%B5%D0%BD%D0%BA%D0%B0-%D0%B8-%D0%B4%D0%B8%D1%81%D0%BF%D0%B5%D1%80%D1%81%D0%B8%D1%8F-%D0%BA%D1%80%D0%B8%D0%B3%D0%B8%D0%BD%D0%B3%D0%B0"><span class="header-section-number">3.4.24</span> Оценка и дисперсия кригинга</a></li>
<li><a class="nav-link" href="#%D0%BA%D1%80%D0%BE%D1%81%D1%81-%D0%B2%D0%B0%D0%BB%D0%B8%D0%B4%D0%B0%D1%86%D0%B8%D1%8F-1"><span class="header-section-number">3.4.25</span> Кросс-валидация</a></li>
</ul>
</li>
<li><a class="nav-link" href="#geostat_review"><span class="header-section-number">3.5</span> Краткий обзор</a></li>
<li>
<a class="nav-link" href="#geostat_qt"><span class="header-section-number">3.6</span> Контрольные вопросы и упражнения</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#geostat_q"><span class="header-section-number">3.6.1</span> Вопросы</a></li>
<li><a class="nav-link" href="#geostat_t"><span class="header-section-number">3.6.2</span> Упражнения</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/tsamsonov/r-spatstat-course/blob/master/03-Geostatistics.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/tsamsonov/r-spatstat-course/edit/master/03-Geostatistics.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Пространственная статистика и моделирование на языке R</strong>" was written by Тимофей Самсонов. It was last built on 2021-10-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
